<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tools to fetch and update paths, metadata and state for Mindscope Neuropixels sessions, in the cloud."><link href=https://AllenInstitute.github.io/npc_lims/reference/npc_lims/status/behavior_sessions/ rel=canonical><link href=../ rel=prev><link href=../tracked_sessions/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.2"><title>behavior_sessions - npc_lims</title><link rel=stylesheet href=../../../../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_markdown_exec_ansi.css><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../css/material.css><link rel=stylesheet href=../../../../css/mkdocstrings.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#npc_lims.status.behavior_sessions class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=npc_lims class="md-header__button md-logo" aria-label=npc_lims data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> npc_lims </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> behavior_sessions </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=purple aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/AllenInstitute/npc_lims title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> AllenInstitute/npc_lims </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../.. class=md-tabs__link> Home </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=npc_lims class="md-nav__button md-logo" aria-label=npc_lims data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> npc_lims </label> <div class=md-nav__source> <a href=https://github.com/AllenInstitute/npc_lims title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> AllenInstitute/npc_lims </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../../.. class="md-nav__link "> <span class=md-ellipsis> Home </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=true> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4 checked> <label class=md-nav__link for=__nav_1_4 id=__nav_1_4_label tabindex> <span class=md-ellipsis> API reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_4_label aria-expanded=true> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> API reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> npc_lims </span> </a> <label class="md-nav__link " for=__nav_1_4_1 id=__nav_1_4_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_1_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_1_4_1> <span class="md-nav__icon md-icon"></span> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> npc_lims </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../exceptions/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> exceptions </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> jobs </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4_1_4> <div class="md-nav__link md-nav__container"> <a href=../../metadata/ class="md-nav__link "> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> metadata </span> </a> <label class="md-nav__link " for=__nav_1_4_1_4 id=__nav_1_4_1_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_1_4_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_1_4_1_4> <span class="md-nav__icon md-icon"></span> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> metadata </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../metadata/codeocean/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> codeocean </span> </a> </li> <li class=md-nav__item> <a href=../../metadata/spreadsheets/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> spreadsheets </span> </a> </li> <li class=md-nav__item> <a href=../../metadata/types/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> types </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4_1_5> <div class="md-nav__link md-nav__container"> <a href=../../paths/ class="md-nav__link "> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> paths </span> </a> <label class="md-nav__link " for=__nav_1_4_1_5 id=__nav_1_4_1_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_1_4_1_5_label aria-expanded=false> <label class=md-nav__title for=__nav_1_4_1_5> <span class="md-nav__icon md-icon"></span> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> paths </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paths/cache/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> cache </span> </a> </li> <li class=md-nav__item> <a href=../../paths/codeocean/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> codeocean </span> </a> </li> <li class=md-nav__item> <a href=../../paths/s3/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> s3 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4_1_6> <div class="md-nav__link md-nav__container"> <a href=../../scripts/ class="md-nav__link "> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> scripts </span> </a> <label class="md-nav__link " for=__nav_1_4_1_6 id=__nav_1_4_1_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_1_4_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_1_4_1_6> <span class="md-nav__icon md-icon"></span> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scripts/generate_session_data_assets/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> generate_session_data_assets </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/regenerate_all_nwbs/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> regenerate_all_nwbs </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/run_session_cache_capsule/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> run_session_cache_capsule </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/run_video_processing/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> run_video_processing </span> </a> </li> <li class=md-nav__item> <a href=../../scripts/update_session_status/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> update_session_status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_4_1_7 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> status </span> </a> <label class="md-nav__link " for=__nav_1_4_1_7 id=__nav_1_4_1_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_1_4_1_7_label aria-expanded=true> <label class=md-nav__title for=__nav_1_4_1_7> <span class="md-nav__icon md-icon"></span> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> status </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> behavior_sessions </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> behavior_sessions </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.CACHED_FILE_EXTENSIONS class=md-nav__link> <span class=md-ellipsis> CACHED_FILE_EXTENSIONS </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.CapsuleComputationAPI class=md-nav__link> <span class=md-ellipsis> CapsuleComputationAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.DataAssetAPI class=md-nav__link> <span class=md-ellipsis> DataAssetAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.ResultItemAPI class=md-nav__link> <span class=md-ellipsis> ResultItemAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.MissingCredentials class=md-nav__link> <span class=md-ellipsis> MissingCredentials </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.NoSessionInfo class=md-nav__link> <span class=md-ellipsis> NoSessionInfo </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo class=md-nav__link> <span class=md-ellipsis> SessionInfo </span> </a> <nav class=md-nav aria-label=SessionInfo> <ul class=md-nav__list> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.date class=md-nav__link> <span class=md-ellipsis> date </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.experiment_day class=md-nav__link> <span class=md-ellipsis> experiment_day </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.idx class=md-nav__link> <span class=md-ellipsis> idx </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_annotated class=md-nav__link> <span class=md-ellipsis> is_annotated </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sorted class=md-nav__link> <span class=md-ellipsis> is_sorted </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_surface_channels class=md-nav__link> <span class=md-ellipsis> is_surface_channels </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sync class=md-nav__link> <span class=md-ellipsis> is_sync </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_templeton class=md-nav__link> <span class=md-ellipsis> is_templeton </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_uploaded class=md-nav__link> <span class=md-ellipsis> is_uploaded </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.rig class=md-nav__link> <span class=md-ellipsis> rig </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.task_version class=md-nav__link> <span class=md-ellipsis> task_version </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.training_info class=md-nav__link> <span class=md-ellipsis> training_info </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.excel_to_sqlite class=md-nav__link> <span class=md-ellipsis> excel_to_sqlite() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_all_cache_paths class=md-nav__link> <span class=md-ellipsis> get_all_cache_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_behavior_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_behavior_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_cache_file_suffix class=md-nav__link> <span class=md-ellipsis> get_cache_file_suffix() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_cache_path class=md-nav__link> <span class=md-ellipsis> get_cache_path() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_current_cache_version class=md-nav__link> <span class=md-ellipsis> get_current_cache_version() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_data_asset class=md-nav__link> <span class=md-ellipsis> get_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_data_asset_s3_path class=md-nav__link> <span class=md-ellipsis> get_data_asset_s3_path() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_eye_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_eye_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_face_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_face_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_h5_sync_from_s3 class=md-nav__link> <span class=md-ellipsis> get_h5_sync_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_hdf5_stim_files_from_s3 class=md-nav__link> <span class=md-ellipsis> get_hdf5_stim_files_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_mean_waveform_codeocean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_mean_waveform_codeocean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_nwb_file_from_s3 class=md-nav__link> <span class=md-ellipsis> get_nwb_file_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_path_from_data_asset class=md-nav__link> <span class=md-ellipsis> get_path_from_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_quality_metrics_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_quality_metrics_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_raw_data_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_raw_data_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_raw_data_root class=md-nav__link> <span class=md-ellipsis> get_raw_data_root() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_recording_dirs_experiment_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_recording_dirs_experiment_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name class=md-nav__link> <span class=md-ellipsis> get_session_computation_id_and_data_asset_name() </span> </a> <nav class=md-nav aria-label=get_session_computation_id_and_data_asset_name()> <ul class=md-nav__list> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--session-npc_sessionsessionrecord626791_20220816 class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; session = npc_session.SessionRecord('626791_20220816') </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computations-get_codeocean_clientget_capsule_computationsmodel_capsule_mappingdlc_eye class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; capsule_computations = get_codeocean_client().get_capsule_computations(MODEL_CAPSULE_MAPPING['dlc_eye']) </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computationsraise_for_status class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; capsule_computations.raise_for_status() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--get_session_computation_id_and_data_asset_namesession-eyetracking-capsule_computationsjson class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; get_session_computation_id_and_data_asset_name(session, 'eyetracking', capsule_computations.json()) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_id_from_db_row class=md-nav__link> <span class=md-ellipsis> get_session_id_from_db_row() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_info class=md-nav__link> <span class=md-ellipsis> get_session_info() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_issues class=md-nav__link> <span class=md-ellipsis> get_session_issues() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_kwargs class=md-nav__link> <span class=md-ellipsis> get_session_kwargs() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_raw_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_raw_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_result_data_assets class=md-nav__link> <span class=md-ellipsis> get_session_result_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_sorted_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_sorted_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_units_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_units_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_units_spikes_with_peak_channels_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_units_spikes_with_peak_channels_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_data_repo class=md-nav__link> <span class=md-ellipsis> get_sessions_from_data_repo() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_training_db class=md-nav__link> <span class=md-ellipsis> get_sessions_from_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_with_data_assets class=md-nav__link> <span class=md-ellipsis> get_sessions_with_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_settings_xml_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_settings_xml_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sorted_data_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_sorted_data_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sorted_precurated_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_sorted_precurated_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_sorted_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_sorted_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_sorting_device_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_sorting_device_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_times_codeocean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_times_codeocean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spikesorted_cache_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spikesorted_cache_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subject_data_assets class=md-nav__link> <span class=md-ellipsis> get_subject_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subject_folders_from_data_repo class=md-nav__link> <span class=md-ellipsis> get_subject_folders_from_data_repo() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subjects_from_training_db class=md-nav__link> <span class=md-ellipsis> get_subjects_from_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_surface_channel_root class=md-nav__link> <span class=md-ellipsis> get_surface_channel_root() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_template_metrics_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_template_metrics_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_tissuecyte_annotation_files_from_s3 class=md-nav__link> <span class=md-ellipsis> get_tissuecyte_annotation_files_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_db class=md-nav__link> <span class=md-ellipsis> get_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_spreadsheet_paths class=md-nav__link> <span class=md-ellipsis> get_training_spreadsheet_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_sqlite_paths class=md-nav__link> <span class=md-ellipsis> get_training_sqlite_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_unit_locations_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_unit_locations_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_units_codeoean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_units_codeoean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_units_spikes_codeocean_kilosort_top_level_files class=md-nav__link> <span class=md-ellipsis> get_units_spikes_codeocean_kilosort_top_level_files() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.is_raw_data_asset class=md-nav__link> <span class=md-ellipsis> is_raw_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.is_sorted_data_asset class=md-nav__link> <span class=md-ellipsis> is_sorted_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.update_training_dbs class=md-nav__link> <span class=md-ellipsis> update_training_dbs() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../tracked_sessions/ class=md-nav__link> <span class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> tracked_sessions </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.CACHED_FILE_EXTENSIONS class=md-nav__link> <span class=md-ellipsis> CACHED_FILE_EXTENSIONS </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.CapsuleComputationAPI class=md-nav__link> <span class=md-ellipsis> CapsuleComputationAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.DataAssetAPI class=md-nav__link> <span class=md-ellipsis> DataAssetAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.ResultItemAPI class=md-nav__link> <span class=md-ellipsis> ResultItemAPI </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.MissingCredentials class=md-nav__link> <span class=md-ellipsis> MissingCredentials </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.NoSessionInfo class=md-nav__link> <span class=md-ellipsis> NoSessionInfo </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo class=md-nav__link> <span class=md-ellipsis> SessionInfo </span> </a> <nav class=md-nav aria-label=SessionInfo> <ul class=md-nav__list> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.date class=md-nav__link> <span class=md-ellipsis> date </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.experiment_day class=md-nav__link> <span class=md-ellipsis> experiment_day </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.idx class=md-nav__link> <span class=md-ellipsis> idx </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_annotated class=md-nav__link> <span class=md-ellipsis> is_annotated </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sorted class=md-nav__link> <span class=md-ellipsis> is_sorted </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_surface_channels class=md-nav__link> <span class=md-ellipsis> is_surface_channels </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sync class=md-nav__link> <span class=md-ellipsis> is_sync </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_templeton class=md-nav__link> <span class=md-ellipsis> is_templeton </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_uploaded class=md-nav__link> <span class=md-ellipsis> is_uploaded </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.rig class=md-nav__link> <span class=md-ellipsis> rig </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.task_version class=md-nav__link> <span class=md-ellipsis> task_version </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.SessionInfo.training_info class=md-nav__link> <span class=md-ellipsis> training_info </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.excel_to_sqlite class=md-nav__link> <span class=md-ellipsis> excel_to_sqlite() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_all_cache_paths class=md-nav__link> <span class=md-ellipsis> get_all_cache_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_behavior_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_behavior_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_cache_file_suffix class=md-nav__link> <span class=md-ellipsis> get_cache_file_suffix() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_cache_path class=md-nav__link> <span class=md-ellipsis> get_cache_path() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_current_cache_version class=md-nav__link> <span class=md-ellipsis> get_current_cache_version() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_data_asset class=md-nav__link> <span class=md-ellipsis> get_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_data_asset_s3_path class=md-nav__link> <span class=md-ellipsis> get_data_asset_s3_path() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_eye_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_eye_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_face_video_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_face_video_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_h5_sync_from_s3 class=md-nav__link> <span class=md-ellipsis> get_h5_sync_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_hdf5_stim_files_from_s3 class=md-nav__link> <span class=md-ellipsis> get_hdf5_stim_files_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_mean_waveform_codeocean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_mean_waveform_codeocean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_nwb_file_from_s3 class=md-nav__link> <span class=md-ellipsis> get_nwb_file_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_path_from_data_asset class=md-nav__link> <span class=md-ellipsis> get_path_from_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_quality_metrics_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_quality_metrics_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_raw_data_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_raw_data_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_raw_data_root class=md-nav__link> <span class=md-ellipsis> get_raw_data_root() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_recording_dirs_experiment_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_recording_dirs_experiment_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name class=md-nav__link> <span class=md-ellipsis> get_session_computation_id_and_data_asset_name() </span> </a> <nav class=md-nav aria-label=get_session_computation_id_and_data_asset_name()> <ul class=md-nav__list> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--session-npc_sessionsessionrecord626791_20220816 class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; session = npc_session.SessionRecord('626791_20220816') </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computations-get_codeocean_clientget_capsule_computationsmodel_capsule_mappingdlc_eye class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; capsule_computations = get_codeocean_client().get_capsule_computations(MODEL_CAPSULE_MAPPING['dlc_eye']) </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computationsraise_for_status class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; capsule_computations.raise_for_status() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--get_session_computation_id_and_data_asset_namesession-eyetracking-capsule_computationsjson class=md-nav__link> <span class=md-ellipsis> &gt;&gt;&gt; get_session_computation_id_and_data_asset_name(session, 'eyetracking', capsule_computations.json()) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_id_from_db_row class=md-nav__link> <span class=md-ellipsis> get_session_id_from_db_row() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_info class=md-nav__link> <span class=md-ellipsis> get_session_info() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_issues class=md-nav__link> <span class=md-ellipsis> get_session_issues() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_kwargs class=md-nav__link> <span class=md-ellipsis> get_session_kwargs() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_raw_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_raw_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_result_data_assets class=md-nav__link> <span class=md-ellipsis> get_session_result_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_sorted_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_sorted_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_units_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_units_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_session_units_spikes_with_peak_channels_data_asset class=md-nav__link> <span class=md-ellipsis> get_session_units_spikes_with_peak_channels_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_data_repo class=md-nav__link> <span class=md-ellipsis> get_sessions_from_data_repo() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_training_db class=md-nav__link> <span class=md-ellipsis> get_sessions_from_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sessions_with_data_assets class=md-nav__link> <span class=md-ellipsis> get_sessions_with_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_settings_xml_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_settings_xml_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sorted_data_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_sorted_data_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_sorted_precurated_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_sorted_precurated_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_sorted_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_sorted_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_sorting_device_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_sorting_device_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spike_times_codeocean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spike_times_codeocean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_spikesorted_cache_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_spikesorted_cache_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subject_data_assets class=md-nav__link> <span class=md-ellipsis> get_subject_data_assets() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subject_folders_from_data_repo class=md-nav__link> <span class=md-ellipsis> get_subject_folders_from_data_repo() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_subjects_from_training_db class=md-nav__link> <span class=md-ellipsis> get_subjects_from_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_surface_channel_root class=md-nav__link> <span class=md-ellipsis> get_surface_channel_root() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_template_metrics_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_template_metrics_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_tissuecyte_annotation_files_from_s3 class=md-nav__link> <span class=md-ellipsis> get_tissuecyte_annotation_files_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_db class=md-nav__link> <span class=md-ellipsis> get_training_db() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_spreadsheet_paths class=md-nav__link> <span class=md-ellipsis> get_training_spreadsheet_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_training_sqlite_paths class=md-nav__link> <span class=md-ellipsis> get_training_sqlite_paths() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_unit_locations_paths_from_s3 class=md-nav__link> <span class=md-ellipsis> get_unit_locations_paths_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_units_codeoean_kilosort_path_from_s3 class=md-nav__link> <span class=md-ellipsis> get_units_codeoean_kilosort_path_from_s3() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.get_units_spikes_codeocean_kilosort_top_level_files class=md-nav__link> <span class=md-ellipsis> get_units_spikes_codeocean_kilosort_top_level_files() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.is_raw_data_asset class=md-nav__link> <span class=md-ellipsis> is_raw_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.is_sorted_data_asset class=md-nav__link> <span class=md-ellipsis> is_sorted_data_asset() </span> </a> </li> <li class=md-nav__item> <a href=#npc_lims.status.behavior_sessions.update_training_dbs class=md-nav__link> <span class=md-ellipsis> update_training_dbs() </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/home/runner/work/npc_lims/npc_lims/src/npc_lims/status/behavior_sessions.py title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/home/runner/work/npc_lims/npc_lims/src/npc_lims/status/behavior_sessions.py title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <div class="doc doc-object doc-module"> <h1 id=npc_lims.status.behavior_sessions class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">behavior_sessions</span> <a href=#npc_lims.status.behavior_sessions class=headerlink title="Permanent link">&para;</a></h1> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h2 id=npc_lims.status.behavior_sessions.CACHED_FILE_EXTENSIONS class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">CACHED_FILE_EXTENSIONS</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.CACHED_FILE_EXTENSIONS class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>CACHED_FILE_EXTENSIONS</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span><span class=n>typing</span><span class=o>.</span><span class=n>get_args</span><span class=p>(</span><span class=n>NWBComponentStr</span><span class=p>),</span> <span class=s1>&#39;.parquet&#39;</span><span class=p>)</span>
</code></pre></div> <div class="doc doc-contents "> <p>Mapping of NWB component name to file extension</p> </div> </div> <div class="doc doc-object doc-attribute"> <h2 id=npc_lims.status.behavior_sessions.CapsuleComputationAPI class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">CapsuleComputationAPI</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.CapsuleComputationAPI class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>CapsuleComputationAPI</span><span class=p>:</span> <span class=n>TypeAlias</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;end_status&#39;</span><span class=p>,</span> <span class=s1>&#39;has_results&#39;</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;run_time&#39;</span><span class=p>,</span> <span class=s1>&#39;state&#39;</span><span class=p>],</span> <span class=n>Any</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Result from CodeOceanAPI when querying for computations for a capsule</p> </div> </div> <div class="doc doc-object doc-attribute"> <h2 id=npc_lims.status.behavior_sessions.DataAssetAPI class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">DataAssetAPI</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.DataAssetAPI class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>DataAssetAPI</span><span class=p>:</span> <span class=n>TypeAlias</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;created&#39;</span><span class=p>,</span> <span class=s1>&#39;custom_metadata&#39;</span><span class=p>,</span> <span class=s1>&#39;description&#39;</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;last_used&#39;</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;size&#39;</span><span class=p>,</span> <span class=s1>&#39;sourceBucket&#39;</span><span class=p>,</span> <span class=s1>&#39;state&#39;</span><span class=p>,</span> <span class=s1>&#39;tags&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>],</span> <span class=n>Any</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Result from CodeOcean API when querying data assets.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h2 id=npc_lims.status.behavior_sessions.ResultItemAPI class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">ResultItemAPI</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.ResultItemAPI class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>ResultItemAPI</span><span class=p>:</span> <span class=n>TypeAlias</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;path&#39;</span><span class=p>,</span> <span class=s1>&#39;size&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>],</span> <span class=n>Any</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Result from CodeOceanAPI when querying for results from a computation</p> </div> </div> <div class="doc doc-object doc-class"> <h2 id=npc_lims.status.behavior_sessions.MissingCredentials class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">MissingCredentials</span> <a href=#npc_lims.status.behavior_sessions.MissingCredentials class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#KeyError">KeyError</a></code></p> <p>Raised when a required credential is not found in environment variables.</p> </div> </div> <div class="doc doc-object doc-class"> <h2 id=npc_lims.status.behavior_sessions.NoSessionInfo class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">NoSessionInfo</span> <a href=#npc_lims.status.behavior_sessions.NoSessionInfo class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code></p> <p>Raised when a session is not found in the tracked-sessions database.</p> </div> </div> <div class="doc doc-object doc-class"> <h2 id=npc_lims.status.behavior_sessions.SessionInfo class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">SessionInfo</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents "> <p>Minimal session metadata obtained quickly from a database.</p> <p>Currently using: <a href=https://raw.githubusercontent.com/AllenInstitute/npc_lims/main/tracked_sessions.yaml>https://raw.githubusercontent.com/AllenInstitute/npc_lims/main/tracked_sessions.yaml</a> and training spreadsheets.</p> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.date class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">date</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.date class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>date</span><span class=p>:</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>DateRecord</span>
</code></pre></div> <div class="doc doc-contents "> <p>YY-MM-DD</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.experiment_day class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">experiment_day</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.experiment_day class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>experiment_day</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> <p>Experiment day (ephys recording, or opto experiment), starting from 1 for each subject. <code>None</code> for training behavior-only sessions.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.idx class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">idx</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.idx class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>idx</span><span class=p>:</span> <span class=nb>int</span>
</code></pre></div> <div class="doc doc-contents "> <p>Session index, starting from 0 for each subject on each day. Currently one session per day, so index isn't specified - implicitly equal to 0.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_annotated class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_annotated</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_annotated class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_annotated</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>The subject associated with the sessions has CCF annotation data for probes available on S3.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; next(session.is_annotated for session in get_session_info() if session.is_annotated)
True
</code></pre> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_sorted class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_sorted</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sorted class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_sorted</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>The AIND sorting pipeline has yielded a Result asset for this session.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; next(session.is_sorted for session in get_session_info() if session.is_sorted)
True
</code></pre> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_surface_channels class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_surface_channels</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_surface_channels class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_surface_channels</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>The session has ephys data collected separately to record surface channel.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; get_session_info("DRpilot_660023_20230808").is_surface_channels
True
</code></pre> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_sync class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_sync</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_sync class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_sync</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>The session has sync data, implying more than a behavior-box.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_templeton class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_templeton</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_templeton class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_templeton</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>Uses project in <code>tracked_sessions.yaml</code> if available, then infers from whether the session is in Sam's DR training database.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_session_info</span><span class=p>(</span><span class=s2>&quot;2023-05-15_09-50-06_662983&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>is_templeton</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>get_session_info</span><span class=p>(</span><span class=s2>&quot;DRpilot_644867_20230221&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>is_templeton</span>
<span class=go>False</span>
</code></pre></div> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.is_uploaded class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">is_uploaded</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.is_uploaded class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_uploaded</span><span class=p>:</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p>All of the session's raw data has been uploaded to S3 and can be found in CodeOcean. Not the same as <code>cloud_path</code> being non-None: this property indicates a proper session upload via aind tools, with metadata etc.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nb>next</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>is_uploaded</span> <span class=k>for</span> <span class=n>session</span> <span class=ow>in</span> <span class=n>get_session_info</span><span class=p>()</span> <span class=k>if</span> <span class=n>session</span><span class=o>.</span><span class=n>is_uploaded</span><span class=p>)</span>
<span class=go>True</span>
</code></pre></div> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.rig class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">rig</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.rig class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>rig</span><span class=p>:</span> <span class=nb>str</span>
</code></pre></div> <div class="doc doc-contents "> <p>From DR training spreadsheet (<code>NP2</code>, <code>B2</code>, 'BEH.E`).</p> <ul> <li>does not necessarily match <code>AIBS_RIG_ID</code> on computer</li> <li><code>unknown</code> if not available (for Templeton sessions)</li> </ul> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.task_version class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">task_version</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.task_version class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>task_version</span><span class=p>:</span> <span class=nb>str</span>
</code></pre></div> <div class="doc doc-contents "> <p>From DR training spreadsheet (<code>stage 5 ori AMN moving timeouts repeats</code>). - <code>unknown</code> if not available (for Templeton sessions)</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=npc_lims.status.behavior_sessions.SessionInfo.training_info class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">training_info</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#npc_lims.status.behavior_sessions.SessionInfo.training_info class=headerlink title="Permanent link">&para;</a></h3> <div class="doc-signature highlight"><pre><span></span><code><span class=n>training_info</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Session metadata from Sam's DR training database. - empty dict for Templeton sessions</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; next(get_session_info()).session_info                       # doctest: +SKIP
{'ID': 1, 'start_time': '2023-03-07 12:56:27', 'rig_name': 'B2', 'task_version': 'stage 0 moving', 'hits': '0', 'dprime_same_modality': '', 'dprime_other_modality_go_stim': '', 'pass': '1', 'ignore': '0'}
&gt;&gt;&gt; assert next(session.training_info for session in get_session_info() if session.training_info)
</code></pre> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.excel_to_sqlite class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">excel_to_sqlite</span> <a href=#npc_lims.status.behavior_sessions.excel_to_sqlite class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>excel_to_sqlite</span><span class=p>(</span><span class=n>spreadsheet</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=n>save_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>This code uses the openpyxl package for playing around with excel using Python code to convert complete excel workbook (all sheets) to an SQLite database The code assumes that the first row of every sheet is the column name Every sheet is stored in a separate table The sheet name is assigned as the table name for every sheet.</p> <p>From <a href=https://stackoverflow.com/questions/17439885/export-data-from-excel-to-sqlite-database>https://stackoverflow.com/questions/17439885/export-data-from-excel-to-sqlite-database</a></p> <details class=quote> <summary>Source code in <code>npc_lims/metadata/spreadsheets.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>excel_to_sqlite</span><span class=p>(</span>
    <span class=n>spreadsheet</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span>
    <span class=n>save_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This code uses the openpyxl package for playing around with excel using Python code</span>
<span class=sd>    to convert complete excel workbook (all sheets) to an SQLite database</span>
<span class=sd>    The code assumes that the first row of every sheet is the column name</span>
<span class=sd>    Every sheet is stored in a separate table</span>
<span class=sd>    The sheet name is assigned as the table name for every sheet.</span>

<span class=sd>    From</span>
<span class=sd>    https://stackoverflow.com/questions/17439885/export-data-from-excel-to-sqlite-database</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>spreadsheet</span> <span class=o>=</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>spreadsheet</span><span class=p>)</span>
    <span class=n>save_path</span> <span class=o>=</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>save_path</span><span class=p>)</span>

    <span class=n>db_path</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkstemp</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.sqlite&quot;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>xls_path</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkstemp</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=n>spreadsheet</span><span class=o>.</span><span class=n>suffix</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>xls_path</span><span class=p>)</span><span class=o>.</span><span class=n>write_bytes</span><span class=p>(</span><span class=n>spreadsheet</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>())</span>

    <span class=c1># Replace with a database name</span>
    <span class=n>con</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span>

    <span class=c1># replace with the complete path to your excel workbook</span>
    <span class=n>wb</span> <span class=o>=</span> <span class=n>openpyxl</span><span class=o>.</span><span class=n>load_workbook</span><span class=p>(</span><span class=n>filename</span><span class=o>=</span><span class=n>xls_path</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>slugify</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>lower</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>lower</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>text</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=n>text</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;d&#39;&quot;</span><span class=p>,</span> <span class=s2>&quot;dprime&quot;</span><span class=p>)</span>
        <span class=n>text</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;[^\w _-]+&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
        <span class=n>text</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;[- ]+&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>text</span>

    <span class=k>for</span> <span class=n>sheet</span> <span class=ow>in</span> <span class=n>wb</span><span class=o>.</span><span class=n>sheetnames</span><span class=p>:</span>
        <span class=n>ws</span> <span class=o>=</span> <span class=n>wb</span><span class=p>[</span><span class=n>sheet</span><span class=p>]</span>
        <span class=n>columns</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>duplicate_column_idx</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>query</span> <span class=o>=</span> <span class=p>(</span>
            <span class=s2>&quot;CREATE TABLE &quot;</span>
            <span class=o>+</span> <span class=nb>repr</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>slugify</span><span class=p>(</span><span class=n>sheet</span><span class=p>)))</span>
            <span class=o>+</span> <span class=s2>&quot;(ID INTEGER PRIMARY KEY AUTOINCREMENT&quot;</span>
        <span class=p>)</span>
        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>ws</span><span class=o>.</span><span class=n>rows</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>row</span><span class=p>):</span>
                <span class=n>column_name</span> <span class=o>=</span> <span class=n>slugify</span><span class=p>(</span><span class=n>col</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>column_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>:</span>
                    <span class=n>query</span> <span class=o>+=</span> <span class=s2>&quot;, &quot;</span> <span class=o>+</span> <span class=n>column_name</span> <span class=o>+</span> <span class=s2>&quot; TEXT&quot;</span>
                    <span class=n>columns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>column_name</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>duplicate_column_idx</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
            <span class=k>break</span>  <span class=c1># only want column names from first row</span>
        <span class=n>query</span> <span class=o>+=</span> <span class=s2>&quot;);&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>columns</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

        <span class=n>tup</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>ws</span><span class=p>):</span>
            <span class=n>tuprow</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>col</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>duplicate_column_idx</span><span class=p>:</span>
                    <span class=k>continue</span>
                <span class=n>tuprow</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>col</span><span class=o>.</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span> <span class=k>if</span> <span class=nb>str</span><span class=p>(</span>
                    <span class=n>col</span><span class=o>.</span><span class=n>value</span>
                <span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=o>!=</span> <span class=s2>&quot;None&quot;</span> <span class=k>else</span> <span class=n>tuprow</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
            <span class=n>tup</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>tuprow</span><span class=p>))</span>

        <span class=n>insQuery1</span> <span class=o>=</span> <span class=s2>&quot;INSERT INTO &quot;</span> <span class=o>+</span> <span class=nb>repr</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>slugify</span><span class=p>(</span><span class=n>sheet</span><span class=p>)))</span> <span class=o>+</span> <span class=s2>&quot;(&quot;</span>
        <span class=n>insQuery2</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
        <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>:</span>
            <span class=n>insQuery1</span> <span class=o>+=</span> <span class=n>col</span> <span class=o>+</span> <span class=s2>&quot;, &quot;</span>
            <span class=n>insQuery2</span> <span class=o>+=</span> <span class=s2>&quot;?, &quot;</span>
        <span class=n>insQuery1</span> <span class=o>=</span> <span class=n>insQuery1</span><span class=p>[:</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;) VALUES(&quot;</span>
        <span class=n>insQuery2</span> <span class=o>=</span> <span class=n>insQuery2</span><span class=p>[:</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;)&quot;</span>
        <span class=n>insQuery</span> <span class=o>=</span> <span class=n>insQuery1</span> <span class=o>+</span> <span class=n>insQuery2</span>

        <span class=n>con</span><span class=o>.</span><span class=n>executemany</span><span class=p>(</span><span class=n>insQuery</span><span class=p>,</span> <span class=n>tup</span><span class=p>)</span>
        <span class=n>con</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>

    <span class=n>con</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
    <span class=n>save_path</span><span class=o>.</span><span class=n>write_bytes</span><span class=p>(</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>())</span>
    <span class=k>return</span> <span class=n>save_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_all_cache_paths class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_all_cache_paths</span> <a href=#npc_lims.status.behavior_sessions.get_all_cache_paths class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_all_cache_paths</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>For a particular NWB component, return cached file paths for all sessions, for the latest version (default) or a specific version.</p> <blockquote> <blockquote> <blockquote> <p>get_all_cache_paths("units", version="0.0.0") ()</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/cache.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_all_cache_paths</span><span class=p>(</span>
    <span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>,</span>
    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    For a particular NWB component, return cached file paths for all sessions, for</span>
<span class=sd>    the latest version (default) or a specific version.</span>

<span class=sd>    &gt;&gt;&gt; get_all_cache_paths(&quot;units&quot;, version=&quot;0.0.0&quot;)</span>
<span class=sd>    ()</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>dir_path</span> <span class=o>=</span> <span class=n>get_cache_path</span><span class=p>(</span>
        <span class=n>nwb_component</span><span class=o>=</span><span class=n>nwb_component</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=n>version</span><span class=p>,</span> <span class=n>consolidated</span><span class=o>=</span><span class=kc>False</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>dir_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Cache directory for </span><span class=si>{</span><span class=n>nwb_component</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>version</span><span class=si>=}</span><span class=s2> does not exist&quot;</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>dir_path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;*</span><span class=si>{</span><span class=n>get_cache_file_suffix</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_behavior_video_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_behavior_video_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_behavior_video_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_behavior_video_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <blockquote> <blockquote> <blockquote> <p>get_behavior_video_path_from_s3('686740_2023-10-26') S3Path('s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Behavior_20231026T122922.mp4')</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_behavior_video_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    &gt;&gt;&gt; get_behavior_video_path_from_s3(&#39;686740_2023-10-26&#39;)</span>
<span class=sd>    S3Path(&#39;s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Behavior_20231026T122922.mp4&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>behavior_video_path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>path</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>raw_data_paths</span>
        <span class=k>if</span> <span class=s2>&quot;Behavior&quot;</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>stem</span> <span class=ow>and</span> <span class=n>path</span><span class=o>.</span><span class=n>suffix</span> <span class=ow>in</span> <span class=n>VIDEO_SUFFIXES</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>behavior_video_path</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no behavior video on s3&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>behavior_video_path</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_cache_file_suffix class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_cache_file_suffix</span> <a href=#npc_lims.status.behavior_sessions.get_cache_file_suffix class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_cache_file_suffix</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span>
</code></pre></div> <div class="doc doc-contents "> <blockquote> <blockquote> <blockquote> <p>get_cache_file_suffix("session") '.parquet'</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/cache.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_cache_file_suffix</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    &gt;&gt;&gt; get_cache_file_suffix(&quot;session&quot;)</span>
<span class=sd>    &#39;.parquet&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ext</span> <span class=o>:=</span> <span class=n>CACHED_FILE_EXTENSIONS</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Unknown NWB component </span><span class=si>{</span><span class=n>nwb_component</span><span class=si>!r}</span><span class=s2> - must be one of </span><span class=si>{</span><span class=n>NWBComponentStr</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>ext</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_cache_path class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_cache_path</span> <a href=#npc_lims.status.behavior_sessions.get_cache_path class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_cache_path</span><span class=p>(</span><span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>consolidated</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>If version is not specified, the latest version currently in the cache will be used, ie. will point to the most recent version of the file.</p> <blockquote> <blockquote> <blockquote> <p>get_cache_path(nwb_component="units", version="1.0.0") S3Path('s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/units') get_cache_path(nwb_component="units", session_id="366122_2023-12-31", version="1.0.0") S3Path('s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/units/366122_2023-12-31.parquet') get_cache_path(nwb_component="trials", version="1.0.0") S3Path('s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/consolidated/trials.parquet')</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/cache.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_cache_path</span><span class=p>(</span>
    <span class=n>nwb_component</span><span class=p>:</span> <span class=n>NWBComponentStr</span><span class=p>,</span>
    <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>consolidated</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    If version is not specified, the latest version currently in the cache will be</span>
<span class=sd>    used, ie. will point to the most recent version of the file.</span>

<span class=sd>    &gt;&gt;&gt; get_cache_path(nwb_component=&quot;units&quot;, version=&quot;1.0.0&quot;)</span>
<span class=sd>    S3Path(&#39;s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/units&#39;)</span>
<span class=sd>    &gt;&gt;&gt; get_cache_path(nwb_component=&quot;units&quot;, session_id=&quot;366122_2023-12-31&quot;, version=&quot;1.0.0&quot;)</span>
<span class=sd>    S3Path(&#39;s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/units/366122_2023-12-31.parquet&#39;)</span>
<span class=sd>    &gt;&gt;&gt; get_cache_path(nwb_component=&quot;trials&quot;, version=&quot;1.0.0&quot;)</span>
<span class=sd>    S3Path(&#39;s3://aind-scratch-data/ben.hardcastle/cache/nwb_components/v1.0.0/consolidated/trials.parquet&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>path</span> <span class=o>=</span> <span class=n>_parse_cache_path</span><span class=p>(</span>
        <span class=n>session_id</span><span class=o>=</span><span class=n>session_id</span><span class=p>,</span> <span class=n>nwb_component</span><span class=o>=</span><span class=n>nwb_component</span><span class=p>,</span> <span class=n>version</span><span class=o>=</span><span class=n>version</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>consolidated</span> <span class=ow>and</span> <span class=n>session_id</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>nwb_component</span> <span class=o>!=</span> <span class=s2>&quot;units&quot;</span><span class=p>:</span>
        <span class=n>path</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span> <span class=o>/</span> <span class=s2>&quot;consolidated&quot;</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>nwb_component</span><span class=si>}</span><span class=s2>.parquet&quot;</span>
    <span class=k>return</span> <span class=n>path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_current_cache_version class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_current_cache_version</span> <a href=#npc_lims.status.behavior_sessions.get_current_cache_version class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_current_cache_version</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>str</span>
</code></pre></div> <div class="doc doc-contents "> <p>The current version of npc_sessions, formatted as a string starting with 'v'.</p> <blockquote> <blockquote> <blockquote> <p>(get_cache_path(nwb_component="units", session_id="366122_2023-12-31", version="v0.0.0").parent / 'test.txt').touch() v = get_current_cache_version() assert v &gt;= 'v0.0.0'</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/cache.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_current_cache_version</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;The current version of npc_sessions, formatted as a string starting with</span>
<span class=sd>    &#39;v&#39;.</span>

<span class=sd>    &gt;&gt;&gt; (get_cache_path(nwb_component=&quot;units&quot;, session_id=&quot;366122_2023-12-31&quot;, version=&quot;v0.0.0&quot;).parent / &#39;test.txt&#39;).touch()</span>
<span class=sd>    &gt;&gt;&gt; v = get_current_cache_version()</span>
<span class=sd>    &gt;&gt;&gt; assert v &gt;= &#39;v0.0.0&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=n>version_dirs</span> <span class=o>:=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>CACHE_ROOT</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;v*&quot;</span><span class=p>))):</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No cache versions found in </span><span class=si>{</span><span class=n>CACHE_ROOT</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=n>npc_sessions_info</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;https://pypi.org/pypi/npc_sessions/json&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>_parse_version</span><span class=p>(</span><span class=n>npc_sessions_info</span><span class=p>[</span><span class=s2>&quot;info&quot;</span><span class=p>][</span><span class=s2>&quot;version&quot;</span><span class=p>])</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_data_asset</span> <a href=#npc_lims.status.behavior_sessions.get_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span>
</code></pre></div> <div class="doc doc-contents "> <p>Converts an asset uuid to dict of info from CodeOcean API.</p> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>uuid</span><span class=o>.</span><span class=n>UUID</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Converts an asset uuid to dict of info from CodeOcean API.&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>asset</span><span class=p>,</span> <span class=n>Mapping</span><span class=p>):</span>
        <span class=n>response</span> <span class=o>=</span> <span class=n>get_codeocean_client</span><span class=p>()</span><span class=o>.</span><span class=n>get_data_asset</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>asset</span><span class=p>))</span>
        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
        <span class=n>asset</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>asset</span><span class=p>,</span> <span class=n>Mapping</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Unexpected </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span><span class=w> </span><span class=si>= }</span><span class=s2>, </span><span class=si>{</span><span class=n>asset</span><span class=w> </span><span class=si>= }</span><span class=s2>&quot;</span>
    <span class=k>return</span> <span class=n>asset</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_data_asset_s3_path class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_data_asset_s3_path</span> <a href=#npc_lims.status.behavior_sessions.get_data_asset_s3_path class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_data_asset_s3_path</span><span class=p>(</span><span class=n>asset_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>codeocean</span><span class=o>.</span><span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>Path on s3 that contains actual data for CodeOcean data asset.</p> <ul> <li>asset <code>id</code> is a UUID</li> <li>accept anything with an "id" attribute or key, or a string Assumes that the data asset has data on s3, which may not be true, and we can't tell from asset info.</li> </ul> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_data_asset_s3_path</span><span class=p>(</span><span class=n>asset_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>codeocean</span><span class=o>.</span><span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Path on s3 that contains actual data for CodeOcean data asset.</span>

<span class=sd>    - asset `id` is a UUID</span>
<span class=sd>    - accept anything with an &quot;id&quot; attribute or key, or a string</span>
<span class=sd>    Assumes that the data asset has data on s3, which may not be true, and we can&#39;t tell from asset info.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>bucket</span> <span class=o>=</span> <span class=n>CODE_OCEAN_DATA_BUCKET</span>
    <span class=k>with</span> <span class=n>contextlib</span><span class=o>.</span><span class=n>suppress</span><span class=p>(</span><span class=ne>AttributeError</span><span class=p>,</span> <span class=ne>KeyError</span><span class=p>):</span>
        <span class=n>bucket</span> <span class=o>=</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;s3://</span><span class=si>{</span><span class=n>asset_id</span><span class=p>[</span><span class=s2>&quot;sourceBucket&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>))</span>  <span class=c1># type: ignore[index]</span>
    <span class=k>with</span> <span class=n>contextlib</span><span class=o>.</span><span class=n>suppress</span><span class=p>(</span><span class=ne>AttributeError</span><span class=p>,</span> <span class=ne>KeyError</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>bucket</span> <span class=o>/</span> <span class=n>asset_id</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>  <span class=c1># type: ignore[union-attr, operator]</span>
    <span class=k>with</span> <span class=n>contextlib</span><span class=o>.</span><span class=n>suppress</span><span class=p>(</span><span class=ne>AttributeError</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>bucket</span> <span class=o>/</span> <span class=n>asset_id</span><span class=o>.</span><span class=n>id</span>  <span class=c1># type: ignore[union-attr]</span>
    <span class=k>return</span> <span class=n>bucket</span> <span class=o>/</span> <span class=nb>str</span><span class=p>(</span><span class=n>asset_id</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_eye_video_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_eye_video_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_eye_video_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_eye_video_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <blockquote> <blockquote> <blockquote> <p>get_eye_video_path_from_s3('686740_2023-10-26') S3Path('s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Eye_20231026T122922.mp4')</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_eye_video_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    &gt;&gt;&gt; get_eye_video_path_from_s3(&#39;686740_2023-10-26&#39;)</span>
<span class=sd>    S3Path(&#39;s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Eye_20231026T122922.mp4&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>eye_video_path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>path</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>raw_data_paths</span>
        <span class=k>if</span> <span class=s2>&quot;Eye&quot;</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>stem</span> <span class=ow>and</span> <span class=n>path</span><span class=o>.</span><span class=n>suffix</span> <span class=ow>in</span> <span class=n>VIDEO_SUFFIXES</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>eye_video_path</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no eye video on s3&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>eye_video_path</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_face_video_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_face_video_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_face_video_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_face_video_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <blockquote> <blockquote> <blockquote> <p>get_face_video_path_from_s3('686740_2023-10-26') S3Path('s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Face_20231026T122923.mp4')</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_face_video_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    &gt;&gt;&gt; get_face_video_path_from_s3(&#39;686740_2023-10-26&#39;)</span>
<span class=sd>    S3Path(&#39;s3://aind-ephys-data/ecephys_686740_2023-10-26_12-29-08/behavior_videos/Face_20231026T122923.mp4&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>face_video_path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>path</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>raw_data_paths</span>
        <span class=k>if</span> <span class=s2>&quot;Face&quot;</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>stem</span> <span class=ow>and</span> <span class=n>path</span><span class=o>.</span><span class=n>suffix</span> <span class=ow>in</span> <span class=n>VIDEO_SUFFIXES</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>face_video_path</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no face video on s3&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>face_video_path</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_h5_sync_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_h5_sync_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_h5_sync_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_h5_sync_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_h5_sync_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_20230821&#39;</span><span class=p>)</span>
<span class=go>S3Path(&#39;s3://aind-ephys-data/ecephys_662892_2023-08-21_12-43-45/behavior/20230821T124345.h5&#39;)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_h5_sync_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_h5_sync_from_s3(&#39;662892_20230821&#39;)</span>
<span class=sd>        S3Path(&#39;s3://aind-ephys-data/ecephys_662892_2023-08-21_12-43-45/behavior/20230821T124345.h5&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths_s3</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>sync_path</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>raw_data_paths_s3</span> <span class=k>if</span> <span class=s2>&quot;.h5&quot;</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>suffix</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>sync_path</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No sync file found in </span><span class=si>{</span><span class=n>raw_data_paths_s3</span><span class=si>!r}</span><span class=s2>&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>sync_path</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_hdf5_stim_files_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_hdf5_stim_files_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_hdf5_stim_files_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_hdf5_stim_files_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>StimFile</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>All the stim files for a session, from the synced <code>DynamicRoutingTask/Data</code> folder on s3.</p> <ul> <li>filters out files that are obviously wrong</li> </ul> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>files</span> <span class=o>=</span> <span class=n>get_hdf5_stim_files_from_s3</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>files</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>time</span>
<span class=go>(&#39;DynamicRouting1&#39;, &#39;13:25:00&#39;)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_hdf5_stim_files_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>StimFile</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;All the stim files for a session, from the synced</span>
<span class=sd>    `DynamicRoutingTask/Data` folder on s3.</span>

<span class=sd>    - filters out files that are obviously wrong</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; files = get_hdf5_stim_files_from_s3(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(files) &gt; 0</span>
<span class=sd>        &gt;&gt;&gt; files[0].name, files[0].time</span>
<span class=sd>        (&#39;DynamicRouting1&#39;, &#39;13:25:00&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>root</span> <span class=o>=</span> <span class=n>DR_DATA_REPO</span> <span class=o>/</span> <span class=nb>str</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>root</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>DR_DATA_REPO</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>DR_DATA_REPO</span><span class=w> </span><span class=si>= }</span><span class=s2> does not exist&quot;</span><span class=p>)</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Subject </span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=si>}</span><span class=s2> hdf5s not on s3: may have been run by NSB, in which case they are on lims2&quot;</span>
        <span class=p>)</span>
    <span class=n>file_glob</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;*_</span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>date</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>_??????.hdf5&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>StimFile</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>session</span><span class=p>)</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>root</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>file_glob</span><span class=p>)]</span>

    <span class=n>test_glob</span> <span class=o>=</span> <span class=n>file_glob</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=p>),</span> <span class=s2>&quot;test&quot;</span><span class=p>)</span>
    <span class=n>files</span> <span class=o>+=</span> <span class=p>[</span>
        <span class=n>StimFile</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>session</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>root</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>test_glob</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=p>)</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>as_posix</span><span class=p>()</span>
    <span class=p>]</span>

    <span class=c1># no empty files:</span>
    <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>f</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=n>f</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>]</span>

    <span class=c1># single behavior task:</span>
    <span class=n>behavior_tasks</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>f</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=s2>&quot;DynamicRouting&quot;</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>behavior_tasks</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>largest</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>behavior_tasks</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>f</span><span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>size</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>behavior_tasks</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>f</span><span class=o>.</span><span class=n>path</span> <span class=o>!=</span> <span class=n>largest</span><span class=o>.</span><span class=n>path</span><span class=p>:</span>
                <span class=n>files</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>files</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_mean_waveform_codeocean_kilosort_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_mean_waveform_codeocean_kilosort_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_mean_waveform_codeocean_kilosort_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_mean_waveform_codeocean_kilosort_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>path</span> <span class=o>=</span> <span class=n>get_spike_times_codeocean_kilosort_path_from_s3</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>path</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_mean_waveform_codeocean_kilosort_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; path = get_spike_times_codeocean_kilosort_path_from_s3(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert path</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=n>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>mean_waveforms_path</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=s2>&quot;mean&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>mean_waveforms_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_nwb_file_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_nwb_file_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_nwb_file_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_nwb_file_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_nwb_file_from_s3</span><span class=p>(</span><span class=s1>&#39;636766_20230125&#39;</span><span class=p>)</span>
<span class=go>S3Path(&#39;s3://aind-scratch-data/ben.hardcastle/nwb/nwb/DRpilot_636766_20230125.nwb&#39;)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_nwb_file_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_nwb_file_from_s3(&#39;636766_20230125&#39;)</span>
<span class=sd>        S3Path(&#39;s3://aind-scratch-data/ben.hardcastle/nwb/nwb/DRpilot_636766_20230125.nwb&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>root</span> <span class=o>=</span> <span class=n>NWB_REPO</span>
    <span class=n>glob</span> <span class=o>=</span> <span class=s2>&quot;*.nwb*&quot;</span>
    <span class=n>result</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=p>(</span>
            <span class=n>path</span>
            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>root</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>glob</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>session</span> <span class=o>==</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
        <span class=p>),</span>
        <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No NWB file found at </span><span class=si>{</span><span class=n>root</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>glob</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>result</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_path_from_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_path_from_data_asset</span> <a href=#npc_lims.status.behavior_sessions.get_path_from_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_path_from_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>Reconstruct path to raw data in bucket (e.g. on s3) using data asset uuid or dict of info from Code Ocean API.</p> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_path_from_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Reconstruct path to raw data in bucket (e.g. on s3) using data asset</span>
<span class=sd>    uuid or dict of info from Code Ocean API.&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=s2>&quot;sourceBucket&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>asset</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Asset </span><span class=si>{</span><span class=n>asset</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> has no `sourceBucket` info - not sure how to create UPath:</span><span class=se>\n</span><span class=si>{</span><span class=n>asset</span><span class=si>!r}</span><span class=s2>&quot;</span>
        <span class=p>)</span>
    <span class=n>bucket_info</span> <span class=o>=</span> <span class=n>asset</span><span class=p>[</span><span class=s2>&quot;sourceBucket&quot;</span><span class=p>]</span>
    <span class=n>roots</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;aws&quot;</span><span class=p>:</span> <span class=s2>&quot;s3&quot;</span><span class=p>,</span> <span class=s2>&quot;gcs&quot;</span><span class=p>:</span> <span class=s2>&quot;gs&quot;</span><span class=p>}</span>
    <span class=k>if</span> <span class=n>bucket_info</span><span class=p>[</span><span class=s2>&quot;origin&quot;</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>roots</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Unknown bucket origin - not sure how to create UPath: </span><span class=si>{</span><span class=n>bucket_info</span><span class=w> </span><span class=si>= }</span><span class=s2>&quot;</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>roots</span><span class=p>[</span><span class=n>bucket_info</span><span class=p>[</span><span class=s1>&#39;origin&#39;</span><span class=p>]]</span><span class=si>}</span><span class=s2>://</span><span class=si>{</span><span class=n>bucket_info</span><span class=p>[</span><span class=s1>&#39;bucket&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>bucket_info</span><span class=p>[</span><span class=s1>&#39;prefix&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_quality_metrics_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_quality_metrics_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_quality_metrics_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_quality_metrics_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>quality_metrics_paths</span> <span class=o>=</span> <span class=n>get_quality_metrics_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_2023-08-21&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>quality_metrics_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_quality_metrics_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; quality_metrics_paths = get_quality_metrics_paths_from_s3(&#39;662892_2023-08-21&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(quality_metrics_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sorted_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>postprocessed_files</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>sorted_paths</span> <span class=k>if</span> <span class=s2>&quot;postprocessed&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=n>quality_metrics_paths</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;quality_metrics/metrics.csv&quot;</span><span class=p>))</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>postprocessed_files</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>quality_metrics_paths</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_raw_data_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_raw_data_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_raw_data_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>All top-level files and folders from the <code>ephys</code> &amp; <code>behavior</code> subdirectories in a session's raw data folder on s3.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>files</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span> <span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>files</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_raw_data_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;All top-level files and folders from the `ephys` &amp; `behavior`</span>
<span class=sd>    subdirectories in a session&#39;s raw data folder on s3.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; files = get_raw_data_paths_from_s3 (&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(files) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_root</span> <span class=o>=</span> <span class=n>codeocean</span><span class=o>.</span><span class=n>get_raw_data_root</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>directories</span><span class=p>:</span> <span class=n>Iterator</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>directory</span> <span class=k>for</span> <span class=n>directory</span> <span class=ow>in</span> <span class=n>raw_data_root</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span> <span class=k>if</span> <span class=n>directory</span><span class=o>.</span><span class=n>is_dir</span><span class=p>()</span>
    <span class=p>)</span>
    <span class=n>first_level_files_directories</span><span class=p>:</span> <span class=n>Iterator</span> <span class=o>=</span> <span class=p>(</span>
        <span class=nb>tuple</span><span class=p>(</span><span class=n>directory</span><span class=o>.</span><span class=n>iterdir</span><span class=p>())</span> <span class=k>for</span> <span class=n>directory</span> <span class=ow>in</span> <span class=n>directories</span>
    <span class=p>)</span>

    <span class=n>paths</span> <span class=o>=</span> <span class=n>functools</span><span class=o>.</span><span class=n>reduce</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>add</span><span class=p>,</span> <span class=n>first_level_files_directories</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>paths</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Raw data paths empty for </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> on s3. Looks like an upload was started, but no files have been transferred.&quot;</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>paths</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_raw_data_root class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_raw_data_root</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_raw_data_root class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_raw_data_root</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>Reconstruct path to raw data in bucket (e.g. on s3) using data-asset info from Code Ocean.</p> <pre><code>&gt;&gt;&gt; get_raw_data_root('668759_20230711')
S3Path('s3://aind-ephys-data/ecephys_668759_2023-07-11_13-07-32')
</code></pre> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_raw_data_root</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Reconstruct path to raw data in bucket (e.g. on s3) using data-asset</span>
<span class=sd>    info from Code Ocean.</span>

<span class=sd>        &gt;&gt;&gt; get_raw_data_root(&#39;668759_20230711&#39;)</span>
<span class=sd>        S3Path(&#39;s3://aind-ephys-data/ecephys_668759_2023-07-11_13-07-32&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>raw_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>asset</span> <span class=k>for</span> <span class=n>asset</span> <span class=ow>in</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span> <span class=k>if</span> <span class=n>is_raw_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>raw_asset</span> <span class=o>=</span> <span class=n>get_single_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>raw_assets</span><span class=p>,</span> <span class=s2>&quot;raw&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>get_path_from_data_asset</span><span class=p>(</span><span class=n>raw_asset</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_recording_dirs_experiment_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_recording_dirs_experiment_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_recording_dirs_experiment_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_recording_dirs_experiment_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>recording_dirs</span> <span class=o>=</span> <span class=n>get_recording_dirs_experiment_path_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_20230821&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>recording_dirs</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_recording_dirs_experiment_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; recording_dirs = get_recording_dirs_experiment_path_from_s3(&#39;662892_20230821&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(recording_dirs) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>recording_dirs</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>path</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>raw_data_paths</span>
        <span class=k>if</span> <span class=s2>&quot;Record Node&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;zarr&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>recording_dirs_experiment</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;*/recording*&quot;</span><span class=p>))</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>recording_dirs</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>recording_dirs_experiment</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_computation_id_and_data_asset_name</span> <a href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_computation_id_and_data_asset_name</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=n>model_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>capsule_computations</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>CapsuleComputationAPI</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Returns the computation id and data asset name for the session that will be used to create the data asset Test below fails, since arjun ran capsule but github has different token</p> <h3 id=npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--session-npc_sessionsessionrecord626791_20220816>&gt;&gt;&gt; session = npc_session.SessionRecord('626791_20220816')<a class=headerlink href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--session-npc_sessionsessionrecord626791_20220816 title="Permanent link">&para;</a></h3> <h3 id=npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computations-get_codeocean_clientget_capsule_computationsmodel_capsule_mappingdlc_eye>&gt;&gt;&gt; capsule_computations = get_codeocean_client().get_capsule_computations(MODEL_CAPSULE_MAPPING['dlc_eye'])<a class=headerlink href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computations-get_codeocean_clientget_capsule_computationsmodel_capsule_mappingdlc_eye title="Permanent link">&para;</a></h3> <h3 id=npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computationsraise_for_status>&gt;&gt;&gt; capsule_computations.raise_for_status()<a class=headerlink href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--capsule_computationsraise_for_status title="Permanent link">&para;</a></h3> <h3 id=npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--get_session_computation_id_and_data_asset_namesession-eyetracking-capsule_computationsjson>&gt;&gt;&gt; get_session_computation_id_and_data_asset_name(session, 'eyetracking', capsule_computations.json())<a class=headerlink href=#npc_lims.status.behavior_sessions.get_session_computation_id_and_data_asset_name--get_session_computation_id_and_data_asset_namesession-eyetracking-capsule_computationsjson title="Permanent link">&para;</a></h3> <p>('3010ff06-aae5-4b35-b070-57df9ef85582', 'ecephys_626791_2022-08-16_00-00-00_eyetracking')</p> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_computation_id_and_data_asset_name</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
    <span class=n>model_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>capsule_computations</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>CapsuleComputationAPI</span><span class=p>],</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Returns the computation id and data asset name for the session that will be used to create the data asset</span>
<span class=sd>    Test below fails, since arjun ran capsule but github has different token</span>
<span class=sd>    #&gt;&gt;&gt; session = npc_session.SessionRecord(&#39;626791_20220816&#39;)</span>
<span class=sd>    #&gt;&gt;&gt; capsule_computations = get_codeocean_client().get_capsule_computations(MODEL_CAPSULE_MAPPING[&#39;dlc_eye&#39;])</span>
<span class=sd>    #&gt;&gt;&gt; capsule_computations.raise_for_status()</span>
<span class=sd>    #&gt;&gt;&gt; get_session_computation_id_and_data_asset_name(session, &#39;eyetracking&#39;, capsule_computations.json())</span>
<span class=sd>    (&#39;3010ff06-aae5-4b35-b070-57df9ef85582&#39;, &#39;ecephys_626791_2022-08-16_00-00-00_eyetracking&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>computation</span> <span class=ow>in</span> <span class=n>capsule_computations</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>computation</span><span class=p>[</span><span class=s2>&quot;has_results&quot;</span><span class=p>]:</span>
            <span class=k>continue</span>

        <span class=n>response_result_items</span> <span class=o>=</span> <span class=n>get_codeocean_client</span><span class=p>()</span><span class=o>.</span><span class=n>get_list_result_items</span><span class=p>(</span>
            <span class=n>computation</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=n>response_result_items</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
        <span class=n>result_items</span> <span class=o>=</span> <span class=n>response_result_items</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>

        <span class=n>session_result_item</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
            <span class=n>item</span>
            <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>result_items</span><span class=p>[</span><span class=s2>&quot;items&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span>  <span class=c1># TODO add folder</span>
                <span class=sa>f</span><span class=s2>&quot;ecephys_</span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>date</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>npc_session</span><span class=o>.</span><span class=n>PARSE_TIME</span><span class=si>}</span><span class=s2>.json&quot;</span><span class=p>,</span>
                <span class=n>item</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
            <span class=p>)</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>session_result_item</span><span class=p>:</span>
            <span class=k>continue</span>

        <span class=n>session_item</span> <span class=o>=</span> <span class=n>session_result_item</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>session_comp_id_data_asset_name</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>computation</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
            <span class=n>session_item</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;.json&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;_</span><span class=si>{</span><span class=n>model_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>),</span>
        <span class=p>)</span>
        <span class=k>break</span>

    <span class=k>return</span> <span class=n>session_comp_id_data_asset_name</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_id_from_db_row class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_id_from_db_row</span> <a href=#npc_lims.status.behavior_sessions.get_session_id_from_db_row class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_id_from_db_row</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span><span class=p>,</span> <span class=n>row</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_session_id_from_db_row</span><span class=p>(</span><span class=mi>366122</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;start_time&#39;</span><span class=p>:</span> <span class=s1>&#39;2023-01-30 12:56:27&#39;</span><span class=p>})</span>
<span class=go>&#39;366122_2023-01-30&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/status/behavior_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_id_from_db_row</span><span class=p>(</span>
    <span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span><span class=p>,</span> <span class=n>row</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_session_id_from_db_row(366122, {&#39;start_time&#39;: &#39;2023-01-30 12:56:27&#39;})</span>
<span class=sd>        &#39;366122_2023-01-30&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>subject</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>row</span><span class=p>[</span><span class=nb>next</span><span class=p>(</span><span class=n>k</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>row</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=s1>&#39;start&#39;</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=ow>and</span><span class=w> </span><span class=nb>any</span><span class=p>(</span><span class=n>t</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;date&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;time&#39;</span><span class=p>)))]</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_info class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_info</span> <a href=#npc_lims.status.behavior_sessions.get_session_info class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_info</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=n>SessionInfo</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>bool_filter_kwargs</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>SessionInfo</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span> <span class=o>|</span> <span class=n>SessionInfo</span>
</code></pre></div> <div class="doc doc-contents "> <p>Quickly get a sequence of all tracked sessions.</p> <p>Examples:</p> <pre><code>Each object in the sequence has info about one session:
&gt;&gt;&gt; sessions = get_session_info()
&gt;&gt;&gt; sessions[0].__class__.__name__
'SessionInfo'
&gt;&gt;&gt; sessions[0].is_ephys                    # doctest: +SKIP
True
&gt;&gt;&gt; any(s for s in sessions if s.date.year &lt; 2021)
False

Pass a session str or SessionRecord to get the info for that session:
&gt;&gt;&gt; info = get_session_info("DRpilot_667252_20230927")
&gt;&gt;&gt; assert isinstance(info, SessionInfo)
&gt;&gt;&gt; info.is_templeton
False
</code></pre> <details class=quote> <summary>Source code in <code>npc_lims/status/tracked_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_info</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=n>SessionInfo</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=o>**</span><span class=n>bool_filter_kwargs</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>SessionInfo</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span> <span class=o>|</span> <span class=n>SessionInfo</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Quickly get a sequence of all tracked sessions.</span>

<span class=sd>    Examples:</span>

<span class=sd>        Each object in the sequence has info about one session:</span>
<span class=sd>        &gt;&gt;&gt; sessions = get_session_info()</span>
<span class=sd>        &gt;&gt;&gt; sessions[0].__class__.__name__</span>
<span class=sd>        &#39;SessionInfo&#39;</span>
<span class=sd>        &gt;&gt;&gt; sessions[0].is_ephys                    # doctest: +SKIP</span>
<span class=sd>        True</span>
<span class=sd>        &gt;&gt;&gt; any(s for s in sessions if s.date.year &lt; 2021)</span>
<span class=sd>        False</span>

<span class=sd>        Pass a session str or SessionRecord to get the info for that session:</span>
<span class=sd>        &gt;&gt;&gt; info = get_session_info(&quot;DRpilot_667252_20230927&quot;)</span>
<span class=sd>        &gt;&gt;&gt; assert isinstance(info, SessionInfo)</span>
<span class=sd>        &gt;&gt;&gt; info.is_templeton</span>
<span class=sd>        False</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>SessionInfo</span><span class=p>):</span>
        <span class=n>session</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>id</span>
    <span class=n>tracked_sessions</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span>
        <span class=n>_get_session_info_from_file</span><span class=p>(),</span>
    <span class=p>)</span>
    <span class=n>tracked_sessions</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>_get_session_info_from_data_repo</span><span class=p>())</span>
    <span class=k>if</span> <span class=n>session</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>filtered_sessions</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>s</span>
            <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>tracked_sessions</span>
            <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=nb>getattr</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span> <span class=o>==</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>bool_filter_kwargs</span><span class=o>.</span><span class=n>items</span><span class=p>())</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>filtered_sessions</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>s</span><span class=p>:</span> <span class=n>s</span><span class=o>.</span><span class=n>id</span><span class=o>.</span><span class=n>date</span><span class=p>,</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
    <span class=k>with</span> <span class=n>contextlib</span><span class=o>.</span><span class=n>suppress</span><span class=p>(</span><span class=ne>StopIteration</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>next</span><span class=p>(</span>
            <span class=n>s</span>
            <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>tracked_sessions</span>
            <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=p>(</span><span class=n>record</span> <span class=o>:=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>))</span>
        <span class=p>)</span>
    <span class=k>raise</span> <span class=n>exceptions</span><span class=o>.</span><span class=n>NoSessionInfo</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>record</span><span class=si>}</span><span class=s2> not found in tracked sessions&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_issues class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_issues</span> <a href=#npc_lims.status.behavior_sessions.get_session_issues class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_issues</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=nb>list</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Get a dictionary of all sessions with issues mapped to their issue url.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; issues = get_session_issues()
&gt;&gt;&gt; issues                                                              # doctest: +SKIP
{
    '644867_2023-02-21': ['https://github.com/AllenInstitute/npc_sessions/issues/28'],
    '660023_2023-08-08': ['https://github.com/AllenInstitute/npc_sessions/issues/26'],
}

&gt;&gt;&gt; single_session_issues = get_session_issues("DRPilot_644867_20230221")
&gt;&gt;&gt; assert isinstance(single_session_issues, typing.Sequence)
&gt;&gt;&gt; single_session_issues                                               # doctest: +SKIP
['https://github.com/AllenInstitute/npc_sessions/issues/28']
</code></pre> <details class=quote> <summary>Source code in <code>npc_lims/status/tracked_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_issues</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=nb>list</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get a dictionary of all sessions with issues mapped to their issue url.</span>

<span class=sd>    Examples:</span>

<span class=sd>        &gt;&gt;&gt; issues = get_session_issues()</span>
<span class=sd>        &gt;&gt;&gt; issues                                                              # doctest: +SKIP</span>
<span class=sd>        {</span>
<span class=sd>            &#39;644867_2023-02-21&#39;: [&#39;https://github.com/AllenInstitute/npc_sessions/issues/28&#39;],</span>
<span class=sd>            &#39;660023_2023-08-08&#39;: [&#39;https://github.com/AllenInstitute/npc_sessions/issues/26&#39;],</span>
<span class=sd>        }</span>

<span class=sd>        &gt;&gt;&gt; single_session_issues = get_session_issues(&quot;DRPilot_644867_20230221&quot;)</span>
<span class=sd>        &gt;&gt;&gt; assert isinstance(single_session_issues, typing.Sequence)</span>
<span class=sd>        &gt;&gt;&gt; single_session_issues                                               # doctest: +SKIP</span>
<span class=sd>        [&#39;https://github.com/AllenInstitute/npc_sessions/issues/28&#39;]</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>get_session_info</span><span class=p>(</span><span class=n>session</span><span class=p>)</span><span class=o>.</span><span class=n>issues</span>
        <span class=k>except</span> <span class=n>exceptions</span><span class=o>.</span><span class=n>NoSessionInfo</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>[]</span>
    <span class=k>return</span> <span class=p>{</span>
        <span class=n>session</span><span class=o>.</span><span class=n>id</span><span class=p>:</span> <span class=n>session</span><span class=o>.</span><span class=n>issues</span> <span class=k>for</span> <span class=n>session</span> <span class=ow>in</span> <span class=n>get_session_info</span><span class=p>()</span> <span class=k>if</span> <span class=n>session</span><span class=o>.</span><span class=n>issues</span>
    <span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_kwargs class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_kwargs</span> <a href=#npc_lims.status.behavior_sessions.get_session_kwargs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_kwargs</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=nb>dict</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Get a dictionary of all sessions mapped to their config kwargs. kwargs will be an empty dict if no kwargs have been specified.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; kwargs = get_session_kwargs()
&gt;&gt;&gt; kwargs                                                          # doctest: +SKIP
{   '670248_2023-08-02': {
        'is_task': False,
    },
    '667252_2023-09-25': {
        'invalid_times': [
            {'start_time': 4996, 'stop_time': -1, 'reason': 'auditory stimulus not presented (amplifier power issue)'}
        ]
    },
}
&gt;&gt;&gt; single_session_kwargs = get_session_kwargs("DRpilot_670248_20230802")
&gt;&gt;&gt; assert isinstance(single_session_kwargs, dict)
&gt;&gt;&gt; single_session_kwargs                                           # doctest: +SKIP
{'is_task': False}
</code></pre> <details class=quote> <summary>Source code in <code>npc_lims/status/tracked_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_kwargs</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>|</span> <span class=nb>dict</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get a dictionary of all sessions mapped to their config kwargs. kwargs will</span>
<span class=sd>    be an empty dict if no kwargs have been specified.</span>

<span class=sd>    Examples:</span>

<span class=sd>        &gt;&gt;&gt; kwargs = get_session_kwargs()</span>
<span class=sd>        &gt;&gt;&gt; kwargs                                                          # doctest: +SKIP</span>
<span class=sd>        {   &#39;670248_2023-08-02&#39;: {</span>
<span class=sd>                &#39;is_task&#39;: False,</span>
<span class=sd>            },</span>
<span class=sd>            &#39;667252_2023-09-25&#39;: {</span>
<span class=sd>                &#39;invalid_times&#39;: [</span>
<span class=sd>                    {&#39;start_time&#39;: 4996, &#39;stop_time&#39;: -1, &#39;reason&#39;: &#39;auditory stimulus not presented (amplifier power issue)&#39;}</span>
<span class=sd>                ]</span>
<span class=sd>            },</span>
<span class=sd>        }</span>
<span class=sd>        &gt;&gt;&gt; single_session_kwargs = get_session_kwargs(&quot;DRpilot_670248_20230802&quot;)</span>
<span class=sd>        &gt;&gt;&gt; assert isinstance(single_session_kwargs, dict)</span>
<span class=sd>        &gt;&gt;&gt; single_session_kwargs                                           # doctest: +SKIP</span>
<span class=sd>        {&#39;is_task&#39;: False}</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>session</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>get_session_info</span><span class=p>(</span><span class=n>session</span><span class=p>)</span><span class=o>.</span><span class=n>session_kwargs</span>
        <span class=k>except</span> <span class=n>exceptions</span><span class=o>.</span><span class=n>NoSessionInfo</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>{}</span>
    <span class=k>return</span> <span class=p>{</span><span class=n>session</span><span class=o>.</span><span class=n>id</span><span class=p>:</span> <span class=n>session</span><span class=o>.</span><span class=n>session_kwargs</span> <span class=k>for</span> <span class=n>session</span> <span class=ow>in</span> <span class=n>get_session_info</span><span class=p>()}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_raw_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_raw_data_asset</span> <a href=#npc_lims.status.behavior_sessions.get_session_raw_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_raw_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_session_raw_data_asset</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)[</span><span class=s2>&quot;id&quot;</span><span class=p>]</span>
<span class=go>&#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_raw_data_asset</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_session_raw_data_asset(&#39;668759_20230711&#39;)[&quot;id&quot;]</span>
<span class=sd>        &#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>raw_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>asset</span> <span class=k>for</span> <span class=n>asset</span> <span class=ow>in</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span> <span class=k>if</span> <span class=n>is_raw_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>raw_assets</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Session </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no raw data assets&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>get_single_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>raw_assets</span><span class=p>,</span> <span class=s2>&quot;raw&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_result_data_assets class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_result_data_assets</span> <a href=#npc_lims.status.behavior_sessions.get_session_result_data_assets class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_result_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>DataAssetAPI</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>result_data_assets</span> <span class=o>=</span> <span class=n>get_session_result_data_assets</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>result_data_assets</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_result_data_assets</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>DataAssetAPI</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; result_data_assets = get_session_result_data_assets(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(result_data_assets) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session_data_assets</span> <span class=o>=</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>result_data_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>data_asset</span>
        <span class=k>for</span> <span class=n>data_asset</span> <span class=ow>in</span> <span class=n>session_data_assets</span>
        <span class=k>if</span> <span class=n>data_asset</span><span class=p>[</span><span class=s2>&quot;type&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;result&quot;</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>result_data_assets</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_sorted_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_sorted_data_asset</span> <a href=#npc_lims.status.behavior_sessions.get_session_sorted_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_sorted_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>sorted_data_asset</span> <span class=o>=</span> <span class=n>get_session_sorted_data_asset</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>sorted_data_asset</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_session_sorted_data_asset</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; sorted_data_asset = get_session_sorted_data_asset(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert isinstance(sorted_data_asset, dict)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session_result_data_assets</span> <span class=o>=</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>sorted_data_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>data_asset</span>
        <span class=k>for</span> <span class=n>data_asset</span> <span class=ow>in</span> <span class=n>session_result_data_assets</span>
        <span class=k>if</span> <span class=n>is_sorted_data_asset</span><span class=p>(</span><span class=n>data_asset</span><span class=p>)</span> <span class=ow>and</span> <span class=n>data_asset</span><span class=p>[</span><span class=s2>&quot;files&quot;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>2</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>sorted_data_assets</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Session </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no sorted data assets&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>get_single_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>sorted_data_assets</span><span class=p>,</span> <span class=s2>&quot;sorted&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_units_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_units_data_asset</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_session_units_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_units_data_asset</span><span class=p>(</span><span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>units_data_asset</span> <span class=o>=</span> <span class=n>get_session_units_data_asset</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>units_data_asset</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_session_units_data_asset</span><span class=p>(</span>
    <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; units_data_asset = get_session_units_data_asset(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert units_data_asset is not None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session_id</span><span class=p>)</span>
    <span class=n>session_data_assets</span> <span class=o>=</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>session_units_data_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>data_asset</span>
        <span class=k>for</span> <span class=n>data_asset</span> <span class=ow>in</span> <span class=n>session_data_assets</span>
        <span class=k>if</span> <span class=s2>&quot;units&quot;</span> <span class=ow>in</span> <span class=n>data_asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=ow>and</span> <span class=s2>&quot;peak&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>data_asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>session_units_data_asset</span> <span class=o>=</span> <span class=n>get_single_data_asset</span><span class=p>(</span>
        <span class=n>session</span><span class=p>,</span> <span class=n>session_units_data_assets</span><span class=p>,</span> <span class=s2>&quot;units&quot;</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>session_units_data_asset</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_session_units_spikes_with_peak_channels_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_session_units_spikes_with_peak_channels_data_asset</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_session_units_spikes_with_peak_channels_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_session_units_spikes_with_peak_channels_data_asset</span><span class=p>(</span><span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>units_peak_channel_data_asset</span> <span class=o>=</span> <span class=n>get_session_units_spikes_with_peak_channels_data_asset</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>units_peak_channel_data_asset</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_session_units_spikes_with_peak_channels_data_asset</span><span class=p>(</span>
    <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataAssetAPI</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; units_peak_channel_data_asset = get_session_units_spikes_with_peak_channels_data_asset(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert units_peak_channel_data_asset is not None</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session_id</span><span class=p>)</span>
    <span class=n>session_data_assets</span> <span class=o>=</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>session_units_spikes_peak_channel_data_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>data_asset</span>
        <span class=k>for</span> <span class=n>data_asset</span> <span class=ow>in</span> <span class=n>session_data_assets</span>
        <span class=k>if</span> <span class=s2>&quot;units_with_peak_channels&quot;</span> <span class=ow>in</span> <span class=n>data_asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>session_units_spikes_peak_channel_data_asset</span> <span class=o>=</span> <span class=n>get_single_data_asset</span><span class=p>(</span>
        <span class=n>session</span><span class=p>,</span> <span class=n>session_units_spikes_peak_channel_data_assets</span><span class=p>,</span> <span class=s2>&quot;units&quot;</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>session_units_spikes_peak_channel_data_asset</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_sessions_from_data_repo class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_sessions_from_data_repo</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_data_repo class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_sessions_from_data_repo</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Globs synced behavior data repo for sessions.</p> <p><strong>Examples:</strong></p> <p>get a dict of all subjects mapped to their sessions:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>all_subjects_sessions</span> <span class=o>=</span> <span class=n>get_sessions_from_data_repo</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=n>all_subjects_sessions</span><span class=p>)</span>
<span class=go>93</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>all_subjects_sessions</span><span class=o>.</span><span class=n>values</span><span class=p>())[</span><span class=mi>0</span><span class=p>])</span>
<span class=go>45</span>
</code></pre></div> <p>get a specific subject's sessions as a sequence:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_sessions_from_data_repo</span><span class=p>(</span><span class=mi>366122</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<span class=go>&#39;366122_2023-01-30&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/status/behavior_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_sessions_from_data_repo</span><span class=p>(</span>
    <span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=p>(</span>
    <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
    <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]]</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Globs synced behavior data repo for sessions.</span>

<span class=sd>    Examples:</span>
<span class=sd>        get a dict of all subjects mapped to their sessions:</span>
<span class=sd>        &gt;&gt;&gt; all_subjects_sessions = get_sessions_from_data_repo()</span>
<span class=sd>        &gt;&gt;&gt; len(all_subjects_sessions)                      # doctest: +SKIP</span>
<span class=sd>        93</span>

<span class=sd>        &gt;&gt;&gt; len(tuple(all_subjects_sessions.values())[0])   # doctest: +SKIP</span>
<span class=sd>        45</span>

<span class=sd>        get a specific subject&#39;s sessions as a sequence:</span>
<span class=sd>        &gt;&gt;&gt; get_sessions_from_data_repo(366122)[0]</span>
<span class=sd>        &#39;366122_2023-01-30&#39;</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span> <span class=nf>_get_sessions_from_subfolders</span><span class=p>(</span>
        <span class=n>folder</span><span class=p>:</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
        <span class=n>sessions</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>folder</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>as_posix</span><span class=p>())</span>
            <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
                <span class=k>continue</span>
            <span class=n>sessions</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
        <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>sessions</span><span class=p>))</span>

    <span class=k>if</span> <span class=n>subject</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>_get_sessions_from_subfolders</span><span class=p>(</span>
            <span class=n>get_subject_folders_from_data_repo</span><span class=p>(</span><span class=n>subject</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=n>subject_to_sessions</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span>
        <span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
    <span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>_subject</span><span class=p>,</span> <span class=n>folder</span> <span class=ow>in</span> <span class=n>get_subject_folders_from_data_repo</span><span class=p>()</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>subject_to_sessions</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>_subject</span><span class=p>,</span> <span class=n>_get_sessions_from_subfolders</span><span class=p>(</span><span class=n>folder</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>subject_to_sessions</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_sessions_from_training_db class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_sessions_from_training_db</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_sessions_from_training_db class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_sessions_from_training_db</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=o>...</span><span class=p>]]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Includes NSB sessions.</p> <p>{subject: ({spreadsheet row}, ... )}</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>sessions</span> <span class=o>=</span> <span class=n>get_sessions_from_training_db</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>sessions</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>sessions</span><span class=p>[</span><span class=mi>659250</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
<span class=go>{&#39;ID&#39;: 1, &#39;start_time&#39;: &#39;2023-03-07 12:56:27&#39;, &#39;rig_name&#39;: &#39;B2&#39;, &#39;task_version&#39;: &#39;stage 0 moving&#39;, &#39;hits&#39;: &#39;0&#39;, &#39;dprime_same_modality&#39;: &#39;&#39;, &#39;dprime_other_modality_go_stim&#39;: &#39;&#39;, &#39;pass&#39;: &#39;1&#39;, &#39;ignore&#39;: &#39;0&#39;}</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/status/behavior_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_sessions_from_training_db</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=o>...</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Includes NSB sessions.</span>

<span class=sd>    {subject: ({spreadsheet row}, ... )}</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; sessions = get_sessions_from_training_db()</span>
<span class=sd>        &gt;&gt;&gt; assert len(sessions) &gt; 0</span>
<span class=sd>        &gt;&gt;&gt; sessions[659250][0]                         # doctest: +SKIP</span>
<span class=sd>        {&#39;ID&#39;: 1, &#39;start_time&#39;: &#39;2023-03-07 12:56:27&#39;, &#39;rig_name&#39;: &#39;B2&#39;, &#39;task_version&#39;: &#39;stage 0 moving&#39;, &#39;hits&#39;: &#39;0&#39;, &#39;dprime_same_modality&#39;: &#39;&#39;, &#39;dprime_other_modality_go_stim&#39;: &#39;&#39;, &#39;pass&#39;: &#39;1&#39;, &#39;ignore&#39;: &#39;0&#39;}</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sessions</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>nsb</span> <span class=ow>in</span> <span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
        <span class=n>db</span> <span class=o>=</span> <span class=n>npc_lims</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=p>)</span>
        <span class=c1>## using tables other than `all_mice`</span>
        <span class=n>subjects</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
            <span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>(</span><span class=n>table</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>])</span>
            <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
                <span class=s2>&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
            <span class=k>if</span> <span class=n>table</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;sqlite_sequence&quot;</span><span class=p>,</span> <span class=s2>&quot;all_mice&quot;</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=k>for</span> <span class=n>subject</span> <span class=ow>in</span> <span class=n>subjects</span><span class=p>:</span>
            <span class=n>sessions</span><span class=p>[</span><span class=n>subject</span><span class=p>]</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
                <span class=n>row</span> <span class=o>|</span> <span class=p>{</span><span class=s2>&quot;nsb&quot;</span><span class=p>:</span> <span class=n>nsb</span><span class=p>}</span>
                <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>&quot;SELECT * FROM &#39;</span><span class=si>{</span><span class=n>subject</span><span class=si>}</span><span class=s2>&#39; WHERE ignore != 1&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
            <span class=p>)</span>
    <span class=k>return</span> <span class=n>sessions</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_sessions_with_data_assets class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_sessions_with_data_assets</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_sessions_with_data_assets class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_sessions_with_data_assets</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>sessions</span> <span class=o>=</span> <span class=n>get_sessions_with_data_assets</span><span class=p>(</span><span class=mi>668759</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>sessions</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_sessions_with_data_assets</span><span class=p>(</span>
    <span class=n>subject</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=nb>int</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; sessions = get_sessions_with_data_assets(668759)</span>
<span class=sd>        &gt;&gt;&gt; assert len(sessions) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>assets</span> <span class=o>=</span> <span class=n>get_subject_data_assets</span><span class=p>(</span><span class=n>subject</span><span class=p>)</span>
    <span class=n>sessions</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>asset</span> <span class=ow>in</span> <span class=n>assets</span><span class=p>:</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>])</span>
        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=n>sessions</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>sessions</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_settings_xml_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_settings_xml_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_settings_xml_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_settings_xml_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>settings_xml_path</span> <span class=o>=</span> <span class=n>get_settings_xml_path_from_s3</span><span class=p>(</span><span class=s1>&#39;670180-2023-07-26&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>settings_xml_path</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_settings_xml_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; settings_xml_path = get_settings_xml_path_from_s3(&#39;670180-2023-07-26&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert settings_xml_path.exists()</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>raw_data_paths_s3</span> <span class=o>=</span> <span class=n>get_raw_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>

    <span class=n>directories</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>raw_path</span>
        <span class=k>for</span> <span class=n>raw_path</span> <span class=ow>in</span> <span class=n>raw_data_paths_s3</span>
        <span class=k>if</span> <span class=n>raw_path</span><span class=o>.</span><span class=n>is_dir</span><span class=p>()</span> <span class=ow>and</span> <span class=s2>&quot;.zarr&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>raw_path</span><span class=o>.</span><span class=n>suffix</span>
    <span class=p>)</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>raw_path</span> <span class=o>/</span> <span class=s2>&quot;settings.xml&quot;</span> <span class=k>for</span> <span class=n>raw_path</span> <span class=ow>in</span> <span class=n>directories</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_sorted_data_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_sorted_data_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_sorted_data_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>sorted_data_asset_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Gets the top level files/folders for the sorted data</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>sorted_data_s3_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>sorted_data_s3_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_sorted_data_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>sorted_data_asset_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Gets the top level files/folders for the sorted data</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; sorted_data_s3_paths = get_sorted_data_paths_from_s3(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(sorted_data_s3_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>sorted_data_asset_id</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sorted_data_asset</span> <span class=o>=</span> <span class=n>codeocean</span><span class=o>.</span><span class=n>get_data_asset</span><span class=p>(</span><span class=n>sorted_data_asset_id</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>session</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sorted_data_asset</span> <span class=o>=</span> <span class=n>codeocean</span><span class=o>.</span><span class=n>get_session_sorted_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Must provide either session or sorted_data_asset_id&quot;</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>get_data_asset_s3_path</span><span class=p>(</span><span class=n>sorted_data_asset</span><span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_sorted_precurated_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_sorted_precurated_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_sorted_precurated_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_sorted_precurated_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>sorted_precurated_paths</span> <span class=o>=</span> <span class=n>get_sorted_precurated_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_2023-08-21&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>sorted_precurated_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_sorted_precurated_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; sorted_precurated_paths = get_sorted_precurated_paths_from_s3(&#39;662892_2023-08-21&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(sorted_precurated_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sorted_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>sorted_precurated_dirs</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span>
            <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>sorted_paths</span> <span class=k>if</span> <span class=s2>&quot;sorting_precurated&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>sorted_precurated_dirs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_spike_sorted_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_spike_sorted_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_spike_sorted_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_spike_sorted_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <blockquote> <blockquote> <blockquote> <p>spike_sorted_paths = get_spike_sorted_paths_from_s3('662892_20230821') assert spike_sorted_paths[0].exists()</p> </blockquote> </blockquote> </blockquote> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_spike_sorted_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    &gt;&gt;&gt; spike_sorted_paths = get_spike_sorted_paths_from_s3(&#39;662892_20230821&#39;)</span>
<span class=sd>    &gt;&gt;&gt; assert spike_sorted_paths[0].exists()</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sorted_data_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>sorted_data_paths</span> <span class=k>if</span> <span class=s2>&quot;spike&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_spike_sorting_device_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_spike_sorting_device_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_spike_sorting_device_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_spike_sorting_device_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=n>device_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_spike_sorting_device_path_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_20230821&#39;</span><span class=p>,</span> <span class=s1>&#39;ProbeA&#39;</span><span class=p>)</span>
<span class=go>S3Path(&#39;s3://codeocean-s3datasetsbucket-1u41qdg42ur9/d527db85-39b7-4c4f-a465-9ca499b0ca47/spikesorted/experiment1_Record Node 102#Neuropix-PXI-100.ProbeA-AP_recording1/sorting_cached.npz&#39;)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_spike_sorting_device_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span> <span class=n>device_name</span><span class=p>:</span> <span class=nb>str</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_spike_sorting_device_path_from_s3(&#39;662892_20230821&#39;, &#39;ProbeA&#39;)</span>
<span class=sd>        S3Path(&#39;s3://codeocean-s3datasetsbucket-1u41qdg42ur9/d527db85-39b7-4c4f-a465-9ca499b0ca47/spikesorted/experiment1_Record Node 102#Neuropix-PXI-100.ProbeA-AP_recording1/sorting_cached.npz&#39;)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>spike_sorted_paths</span> <span class=o>=</span> <span class=n>get_spike_sorted_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>spike_probe_paths</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>spike_sorted_paths</span> <span class=k>if</span> <span class=n>device_name</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=n>sorting_cached_path</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>spike_probe_paths</span> <span class=k>if</span> <span class=s2>&quot;sorting_cached&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>sorting_cached_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_spike_times_codeocean_kilosort_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_spike_times_codeocean_kilosort_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_spike_times_codeocean_kilosort_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_spike_times_codeocean_kilosort_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>path</span> <span class=o>=</span> <span class=n>get_spike_times_codeocean_kilosort_path_from_s3</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>path</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_spike_times_codeocean_kilosort_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; path = get_spike_times_codeocean_kilosort_path_from_s3(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert path</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=n>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>spike_times_path</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=s2>&quot;spike&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>spike_times_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_spikesorted_cache_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_spikesorted_cache_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_spikesorted_cache_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_spikesorted_cache_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>spike_sorted_cache_paths</span> <span class=o>=</span> <span class=n>get_spikesorted_cache_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_20230821&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>spike_sorted_cache_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_spikesorted_cache_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; spike_sorted_cache_paths = get_spikesorted_cache_paths_from_s3(&#39;662892_20230821&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(spike_sorted_cache_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>spike_sorted_paths</span> <span class=o>=</span> <span class=n>get_spike_sorted_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>spike_sorted_cache_files</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;sorting_cached.npz&quot;</span><span class=p>))</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>spike_sorted_paths</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>spike_sorted_cache_files</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_subject_data_assets class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_subject_data_assets</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_subject_data_assets class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_subject_data_assets</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>DataAssetAPI</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>All assets associated with a subject ID.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>assets</span> <span class=o>=</span> <span class=n>get_subject_data_assets</span><span class=p>(</span><span class=mi>668759</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>assets</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_subject_data_assets</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>DataAssetAPI</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    All assets associated with a subject ID.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; assets = get_subject_data_assets(668759)</span>
<span class=sd>        &gt;&gt;&gt; assert len(assets) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>get_codeocean_client</span><span class=p>()</span><span class=o>.</span><span class=n>search_all_data_assets</span><span class=p>(</span>
        <span class=n>query</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;subject id: </span><span class=si>{</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>(</span><span class=n>subject</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=p>)</span>
    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&quot;results&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_subject_folders_from_data_repo class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_subject_folders_from_data_repo</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_subject_folders_from_data_repo class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_subject_folders_from_data_repo</span><span class=p>(</span><span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>]</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>all_subjects</span> <span class=o>=</span> <span class=n>get_subject_folders_from_data_repo</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=n>all_subjects</span><span class=p>)</span>
<span class=go>93</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_subject_folders_from_data_repo</span><span class=p>(</span><span class=mi>366122</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
<span class=go>&#39;366122&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/status/behavior_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_subject_folders_from_data_repo</span><span class=p>(</span>
    <span class=n>subject</span><span class=p>:</span> <span class=nb>int</span> <span class=o>|</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>]</span> <span class=o>|</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; all_subjects = get_subject_folders_from_data_repo()</span>
<span class=sd>        &gt;&gt;&gt; len(all_subjects)                               # doctest: +SKIP</span>
<span class=sd>        93</span>

<span class=sd>        &gt;&gt;&gt; get_subject_folders_from_data_repo(366122).name</span>
<span class=sd>        &#39;366122&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>subject</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span>
            <span class=n>path</span> <span class=o>:=</span> <span class=n>npc_lims</span><span class=o>.</span><span class=n>paths</span><span class=o>.</span><span class=n>DR_DATA_REPO</span>
            <span class=o>/</span> <span class=nb>str</span><span class=p>(</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>(</span><span class=n>subject</span><span class=p>))</span>
        <span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>path</span><span class=si>=}</span><span class=s2> does not exist&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>path</span>
    <span class=n>subject_to_folder</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>npc_lims</span><span class=o>.</span><span class=n>paths</span><span class=o>.</span><span class=n>DR_DATA_REPO</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
        <span class=k>if</span> <span class=n>path</span><span class=o>.</span><span class=n>is_file</span><span class=p>():</span>
            <span class=k>continue</span>
        <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>invalid_key</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>invalid_key</span> <span class=ow>in</span> <span class=n>INVALID_SUBJECT_KEYS</span><span class=p>):</span>
            <span class=k>continue</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>_subject</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
            <span class=k>continue</span>
        <span class=k>if</span> <span class=n>_subject</span> <span class=ow>in</span> <span class=n>subject_to_folder</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Duplicate path for </span><span class=si>{</span><span class=n>_subject</span><span class=si>=}</span><span class=s2>: </span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=n>subject_to_folder</span><span class=p>[</span><span class=n>_subject</span><span class=p>]</span> <span class=o>=</span> <span class=n>path</span>
    <span class=k>return</span> <span class=n>subject_to_folder</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_subjects_from_training_db class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_subjects_from_training_db</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_subjects_from_training_db class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_subjects_from_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span>
</code></pre></div> <div class="doc doc-contents "> <p>Dynamic Routing training spreadsheet info.</p> <p>{subject: ({spreadsheet row}, ... )}</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>subjects</span> <span class=o>=</span> <span class=n>get_subjects_from_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>subjects</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>subjects</span><span class=p>[</span><span class=mi>659250</span><span class=p>]</span>
<span class=go>{&#39;ID&#39;: 50, &#39;mouse_id&#39;: &#39;659250&#39;, &#39;alive&#39;: &#39;False&#39;, &#39;genotype&#39;: &#39;PV Cre x Ai32&#39;, &#39;sex&#39;: &#39;male&#39;, &#39;birthdate&#39;: &#39;2022-11-21 00:00:00&#39;, &#39;surgery_week&#39;: &#39;2023-01-30 00:00:00&#39;, &#39;craniotomy&#39;: &#39;True&#39;, &#39;trainer&#39;: &#39;Sam&#39;, &#39;regimen&#39;: &#39;7&#39;, &#39;wheel_fixed&#39;: &#39;False&#39;, &#39;timeouts&#39;: &#39;True&#39;, &#39;next_task_version&#39;: &#39;dead&#39;}</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/status/behavior_sessions.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_subjects_from_training_db</span><span class=p>(</span>
    <span class=n>nsb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Dynamic Routing training spreadsheet info.</span>

<span class=sd>    {subject: ({spreadsheet row}, ... )}</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; subjects = get_subjects_from_training_db(nsb=True)</span>
<span class=sd>        &gt;&gt;&gt; assert len(subjects) &gt; 0</span>
<span class=sd>        &gt;&gt;&gt; subjects[659250]                       # doctest: +SKIP</span>
<span class=sd>        {&#39;ID&#39;: 50, &#39;mouse_id&#39;: &#39;659250&#39;, &#39;alive&#39;: &#39;False&#39;, &#39;genotype&#39;: &#39;PV Cre x Ai32&#39;, &#39;sex&#39;: &#39;male&#39;, &#39;birthdate&#39;: &#39;2022-11-21 00:00:00&#39;, &#39;surgery_week&#39;: &#39;2023-01-30 00:00:00&#39;, &#39;craniotomy&#39;: &#39;True&#39;, &#39;trainer&#39;: &#39;Sam&#39;, &#39;regimen&#39;: &#39;7&#39;, &#39;wheel_fixed&#39;: &#39;False&#39;, &#39;timeouts&#39;: &#39;True&#39;, &#39;next_task_version&#39;: &#39;dead&#39;}</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>db</span> <span class=o>=</span> <span class=n>npc_lims</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=p>)</span>

    <span class=c1># use entries in `all_mice` table</span>
    <span class=n>subjects</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=p>{</span>
            <span class=n>npc_session</span><span class=o>.</span><span class=n>SubjectRecord</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;mouse_id&quot;</span><span class=p>])</span>
            <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&quot;SELECT * FROM all_mice&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
        <span class=p>}</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=p>{</span>
        <span class=n>subject</span><span class=p>:</span> <span class=n>db</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
            <span class=s2>&quot;SELECT * FROM &#39;all_mice&#39; WHERE mouse_id=?&quot;</span><span class=p>,</span> <span class=p>(</span><span class=n>subject</span><span class=p>,)</span>
        <span class=p>)</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>subject</span> <span class=ow>in</span> <span class=n>subjects</span>
    <span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_surface_channel_root class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_surface_channel_root</span> <a href=#npc_lims.status.behavior_sessions.get_surface_channel_root class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_surface_channel_root</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p>Reconstruct path to surface channel data in bucket (e.g. on s3) using data-asset info from Code Ocean.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>get_surface_channel_root</span><span class=p>(</span><span class=s1>&#39;660023_20230808&#39;</span><span class=p>)</span>
<span class=go>S3Path(&#39;s3://aind-ephys-data/ecephys_660023_2023-08-08_15-11-14&#39;)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>get_surface_channel_root</span><span class=p>(</span><span class=s1>&#39;660023_20230808&#39;</span><span class=p>)</span> <span class=o>!=</span> <span class=n>get_raw_data_root</span><span class=p>(</span><span class=s1>&#39;660023_20230808&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>get_surface_channel_root</span><span class=p>(</span><span class=s1>&#39;649943_20230216&#39;</span><span class=p>)</span>
<span class=gt>Traceback (most recent call last):</span>
<span class=c>...</span>
<span class=gr>FileNotFoundError</span>: <span class=n>649943_20230216 has no surface channel data assets</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_surface_channel_root</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Reconstruct path to surface channel data in bucket (e.g. on s3) using data-asset</span>
<span class=sd>    info from Code Ocean.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; get_surface_channel_root(&#39;660023_20230808&#39;)</span>
<span class=sd>        S3Path(&#39;s3://aind-ephys-data/ecephys_660023_2023-08-08_15-11-14&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert get_surface_channel_root(&#39;660023_20230808&#39;) != get_raw_data_root(&#39;660023_20230808&#39;)</span>
<span class=sd>        &gt;&gt;&gt; get_surface_channel_root(&#39;649943_20230216&#39;)</span>
<span class=sd>        Traceback (most recent call last):</span>
<span class=sd>        ...</span>
<span class=sd>        FileNotFoundError: 649943_20230216 has no surface channel data assets</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>raw_assets</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>asset</span> <span class=k>for</span> <span class=n>asset</span> <span class=ow>in</span> <span class=n>get_session_data_assets</span><span class=p>(</span><span class=n>session</span><span class=p>)</span> <span class=k>if</span> <span class=n>is_raw_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>raw_asset</span> <span class=o>=</span> <span class=n>get_single_data_asset</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>with_idx</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=n>raw_assets</span><span class=p>,</span> <span class=s2>&quot;raw&quot;</span><span class=p>)</span>
    <span class=k>except</span> <span class=n>SessionIndexError</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> has no surface channel data assets&quot;</span>
        <span class=p>)</span> <span class=kn>from</span> <span class=kc>None</span>
    <span class=k>return</span> <span class=n>get_path_from_data_asset</span><span class=p>(</span><span class=n>raw_asset</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_template_metrics_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_template_metrics_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_template_metrics_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_template_metrics_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>template_metrics_paths</span> <span class=o>=</span> <span class=n>get_template_metrics_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_2023-08-21&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>template_metrics_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_template_metrics_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; template_metrics_paths = get_template_metrics_paths_from_s3(&#39;662892_2023-08-21&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(template_metrics_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sorted_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>postprocessed_files</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>sorted_paths</span> <span class=k>if</span> <span class=s2>&quot;postprocessed&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=n>template_metrics_paths</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;template_metrics/metrics.csv&quot;</span><span class=p>))</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>postprocessed_files</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>template_metrics_paths</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_tissuecyte_annotation_files_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_tissuecyte_annotation_files_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_tissuecyte_annotation_files_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_tissuecyte_annotation_files_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p>For each probe inserted, get a csv file containing CCF coordinates for each electrode (channel) on the probe.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>electrode_files</span> <span class=o>=</span> <span class=n>get_tissuecyte_annotation_files_from_s3</span><span class=p>(</span><span class=s1>&#39;626791_2022-08-16&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>electrode_files</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>electrode_files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>name</span>
<span class=go>&#39;Probe_A2_channels_626791_warped_processed.csv&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_tissuecyte_annotation_files_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;For each probe inserted, get a csv file containing CCF coordinates for each</span>
<span class=sd>    electrode (channel) on the probe.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; electrode_files = get_tissuecyte_annotation_files_from_s3(&#39;626791_2022-08-16&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(electrode_files) &gt; 0</span>
<span class=sd>        &gt;&gt;&gt; electrode_files[0].name</span>
<span class=sd>        &#39;Probe_A2_channels_626791_warped_processed.csv&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>day</span> <span class=o>=</span> <span class=n>tracked_sessions</span><span class=o>.</span><span class=n>get_session_info</span><span class=p>(</span><span class=n>session</span><span class=p>)</span><span class=o>.</span><span class=n>experiment_day</span>
    <span class=n>subject_electrode_network_path</span> <span class=o>=</span> <span class=n>TISSUECYTE_REPO</span> <span class=o>/</span> <span class=nb>str</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>subject_electrode_network_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;CCF annotations for </span><span class=si>{</span><span class=n>session</span><span class=si>}</span><span class=s2> have not been uploaded to s3&quot;</span>
        <span class=p>)</span>

    <span class=n>electrode_files</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>subject_electrode_network_path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;Probe_*</span><span class=si>{</span><span class=n>day</span><span class=si>}</span><span class=s2>_channels_</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=o>.</span><span class=n>id</span><span class=p>)</span><span class=si>}</span><span class=s2>_warped_processed.csv&quot;</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>electrode_files</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>subject_electrode_network_path</span><span class=si>}</span><span class=s2> exists, but no CCF annotation files found matching </span><span class=si>{</span><span class=n>day</span><span class=si>}</span><span class=s2> and </span><span class=si>{</span><span class=n>session</span><span class=o>.</span><span class=n>subject</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2> - check session day&quot;</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>electrode_files</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_training_db class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_db</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_training_db class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>Connection</span>
</code></pre></div> <div class="doc doc-contents "> <p>Download db to tempdir, open connection, return connection.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>get_training_db</span><span class=p>()</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/spreadsheets.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_training_db</span><span class=p>(</span><span class=n>nsb</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>Connection</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Download db to tempdir, open connection, return connection.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; assert get_training_db()</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>db_path</span> <span class=o>=</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>(</span><span class=n>tempfile</span><span class=o>.</span><span class=n>mkstemp</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.db&quot;</span><span class=p>)[</span><span class=mi>1</span><span class=p>])</span>
    <span class=n>s3_path</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>get_training_sqlite_paths</span><span class=p>()</span> <span class=k>if</span> <span class=p>(</span><span class=s2>&quot;NSB&quot;</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span><span class=p>)</span> <span class=o>==</span> <span class=n>nsb</span>
    <span class=p>)</span>
    <span class=n>db_path</span><span class=o>.</span><span class=n>write_bytes</span><span class=p>(</span><span class=n>s3_path</span><span class=o>.</span><span class=n>read_bytes</span><span class=p>())</span>
    <span class=n>con</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>db_path</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>dict_factory</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>row</span><span class=p>):</span>
        <span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>cursor</span><span class=o>.</span><span class=n>description</span><span class=p>):</span>
            <span class=n>d</span><span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=k>return</span> <span class=n>d</span>

    <span class=n>con</span><span class=o>.</span><span class=n>row_factory</span> <span class=o>=</span> <span class=n>dict_factory</span>
    <span class=k>return</span> <span class=n>con</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_training_spreadsheet_paths class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_spreadsheet_paths</span> <a href=#npc_lims.status.behavior_sessions.get_training_spreadsheet_paths class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_training_spreadsheet_paths</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>get_training_spreadsheet_paths</span><span class=p>())</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/spreadsheets.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_training_spreadsheet_paths</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; assert len(get_training_spreadsheet_paths()) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>DR_DATA_REPO</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;DynamicRoutingTraining*.xlsx&quot;</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_training_sqlite_paths class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_training_sqlite_paths</span> <a href=#npc_lims.status.behavior_sessions.get_training_sqlite_paths class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_training_sqlite_paths</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>get_training_sqlite_paths</span><span class=p>())</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>get_training_spreadsheet_paths</span><span class=p>())</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/spreadsheets.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>get_training_sqlite_paths</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; assert len(get_training_sqlite_paths()) == len(get_training_spreadsheet_paths())</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=n>path</span><span class=o>.</span><span class=n>with_suffix</span><span class=p>(</span><span class=s2>&quot;.sqlite&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>get_training_spreadsheet_paths</span><span class=p>()</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_unit_locations_paths_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_unit_locations_paths_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_unit_locations_paths_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_unit_locations_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>unit_locations_paths</span> <span class=o>=</span> <span class=n>get_unit_locations_paths_from_s3</span><span class=p>(</span><span class=s1>&#39;662892_2023-08-21&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>unit_locations_paths</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_unit_locations_paths_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; unit_locations_paths = get_unit_locations_paths_from_s3(&#39;662892_2023-08-21&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert len(unit_locations_paths) &gt; 0</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>sorted_paths</span> <span class=o>=</span> <span class=n>get_sorted_data_paths_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>postprocessed_files</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>sorted_paths</span> <span class=k>if</span> <span class=s2>&quot;postprocessed&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
    <span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
    <span class=n>unit_locations_paths</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
        <span class=nb>next</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;unit_locations/unit_locations.npy&quot;</span><span class=p>))</span>
        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>postprocessed_files</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>unit_locations_paths</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_units_codeoean_kilosort_path_from_s3 class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_units_codeoean_kilosort_path_from_s3</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_units_codeoean_kilosort_path_from_s3 class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_units_codeoean_kilosort_path_from_s3</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>path</span> <span class=o>=</span> <span class=n>get_units_codeoean_kilosort_path_from_s3</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>path</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_units_codeoean_kilosort_path_from_s3</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; path = get_units_codeoean_kilosort_path_from_s3(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert path</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>files</span> <span class=o>=</span> <span class=n>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=n>units_path</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>path</span> <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>files</span> <span class=k>if</span> <span class=s2>&quot;csv&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>units_path</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.get_units_spikes_codeocean_kilosort_top_level_files class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_units_spikes_codeocean_kilosort_top_level_files</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> </span> <a href=#npc_lims.status.behavior_sessions.get_units_spikes_codeocean_kilosort_top_level_files class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>paths</span> <span class=o>=</span> <span class=n>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span><span class=s1>&#39;668759_20230711&#39;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>assert</span> <span class=n>paths</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/paths/s3.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@functools</span><span class=o>.</span><span class=n>cache</span>
<span class=k>def</span> <span class=nf>get_units_spikes_codeocean_kilosort_top_level_files</span><span class=p>(</span>
    <span class=n>session</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>npc_session</span><span class=o>.</span><span class=n>SessionRecord</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>upath</span><span class=o>.</span><span class=n>UPath</span><span class=p>,</span> <span class=o>...</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; paths = get_units_spikes_codeocean_kilosort_top_level_files(&#39;668759_20230711&#39;)</span>
<span class=sd>        &gt;&gt;&gt; assert paths</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>units_spikes_data_asset</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>codeocean</span><span class=o>.</span><span class=n>get_session_units_spikes_with_peak_channels_data_asset</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=n>units_directory</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
        <span class=n>unit_path</span>
        <span class=k>for</span> <span class=n>unit_path</span> <span class=ow>in</span> <span class=n>get_data_asset_s3_path</span><span class=p>(</span><span class=n>units_spikes_data_asset</span><span class=p>)</span><span class=o>.</span><span class=n>iterdir</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>unit_path</span><span class=o>.</span><span class=n>is_dir</span><span class=p>()</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>units_directory</span><span class=o>.</span><span class=n>iterdir</span><span class=p>())</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.is_raw_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">is_raw_data_asset</span> <a href=#npc_lims.status.behavior_sessions.is_raw_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_raw_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>is_raw_data_asset</span><span class=p>(</span><span class=s1>&#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;</span><span class=p>)</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_raw_data_asset</span><span class=p>(</span><span class=s1>&#39;173e2fdc-0ca3-4a4e-9886-b74207a91a9a&#39;</span><span class=p>)</span>
<span class=go>False</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>is_raw_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; is_raw_data_asset(&#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;)</span>
<span class=sd>        True</span>
<span class=sd>        &gt;&gt;&gt; is_raw_data_asset(&#39;173e2fdc-0ca3-4a4e-9886-b74207a91a9a&#39;)</span>
<span class=sd>        False</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>asset</span> <span class=o>=</span> <span class=n>get_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>is_sorted_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>False</span>
    <span class=k>return</span> <span class=n>asset</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;custom_metadata&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=s2>&quot;data level&quot;</span>
    <span class=p>)</span> <span class=o>==</span> <span class=s2>&quot;raw data&quot;</span> <span class=ow>or</span> <span class=s2>&quot;raw&quot;</span> <span class=ow>in</span> <span class=n>asset</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>,</span> <span class=p>[])</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.is_sorted_data_asset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">is_sorted_data_asset</span> <a href=#npc_lims.status.behavior_sessions.is_sorted_data_asset class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>is_sorted_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span>
</code></pre></div> <div class="doc doc-contents "> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted_data_asset</span><span class=p>(</span><span class=s1>&#39;173e2fdc-0ca3-4a4e-9886-b74207a91a9a&#39;</span><span class=p>)</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted_data_asset</span><span class=p>(</span><span class=s1>&#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;</span><span class=p>)</span>
<span class=go>False</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/codeocean.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>is_sorted_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>DataAssetAPI</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; is_sorted_data_asset(&#39;173e2fdc-0ca3-4a4e-9886-b74207a91a9a&#39;)</span>
<span class=sd>        True</span>
<span class=sd>        &gt;&gt;&gt; is_sorted_data_asset(&#39;83636983-f80d-42d6-a075-09b60c6abd5e&#39;)</span>
<span class=sd>        False</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>asset</span> <span class=o>=</span> <span class=n>get_data_asset</span><span class=p>(</span><span class=n>asset</span><span class=p>)</span>
    <span class=k>if</span> <span class=s2>&quot;ecephys&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]:</span>
        <span class=k>return</span> <span class=kc>False</span>
    <span class=k>return</span> <span class=s2>&quot;sorted&quot;</span> <span class=ow>in</span> <span class=n>asset</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=npc_lims.status.behavior_sessions.update_training_dbs class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_training_dbs</span> <a href=#npc_lims.status.behavior_sessions.update_training_dbs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc-signature highlight"><pre><span></span><code><span class=n>update_training_dbs</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</code></pre></div> <div class="doc doc-contents "> <p>Read spreadsheets from the data repo and write them to corresponding databases, currently sqlite files in the same directory.</p> <p><strong>Examples:</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>update_training_dbs</span><span class=p>()</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>npc_lims/metadata/spreadsheets.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span> <span class=nf>update_training_dbs</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Read spreadsheets from the data repo and write them to corresponding</span>
<span class=sd>    databases, currently sqlite files in the same directory.</span>

<span class=sd>    Examples:</span>
<span class=sd>        &gt;&gt;&gt; update_training_dbs()</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>spreadsheet</span><span class=p>,</span> <span class=n>sqlite</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span>
        <span class=n>get_training_spreadsheet_paths</span><span class=p>(),</span> <span class=n>get_training_sqlite_paths</span><span class=p>()</span>
    <span class=p>):</span>
        <span class=n>excel_to_sqlite</span><span class=p>(</span><span class=n>spreadsheet</span><span class=p>,</span> <span class=n>sqlite</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="Previous: Index"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Index </div> </div> </a> <a href=../tracked_sessions/ class="md-footer__link md-footer__link--next" aria-label='Next: <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> tracked_sessions'> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> tracked_sessions </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Allen Institute for Neural Dynamics </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/AllenInstitute/npc_lims target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://pypi.org/project/npc-lims/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.d7c377c4.min.js></script> </body> </html>